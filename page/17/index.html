<!DOCTYPE html>


<html lang="zh-Configuration" >


<head>
  <meta charset="utf-8" />
  <meta name="baidu-site-verification" content="code-HzuN3OUvvm" />
    
  <meta name="description" content="努力，奋斗！" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Shine on You Crazy Diamond
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Shine on You Crazy Diamond</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-ROS MoviIt!教程 - 5.Moveit!编程" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%205.Moveit!%E7%BC%96%E7%A8%8B/"
    >ROS MoviIt!学习 - 5.MoveIt! 编程</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%205.Moveit!%E7%BC%96%E7%A8%8B/" class="article-date">
  <time datetime="2021-05-27T09:29:20.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="五、MoveIt-编程"><a href="#五、MoveIt-编程" class="headerlink" title="五、MoveIt! 编程"></a>五、MoveIt! 编程</h1><h2 id="5-1-MoveIt-的编程接口"><a href="#5-1-MoveIt-的编程接口" class="headerlink" title="5.1 MoveIt! 的编程接口"></a>5.1 MoveIt! 的编程接口</h2><p><strong>“move_group” Python Interface：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># "move_group" Python Interface</span></span><br><span class="line">group = moveit_commander.MoveGroupCommander(<span class="string">"left_arm"</span>)</span><br><span class="line"></span><br><span class="line">pose_target = geometry_msgs.msg.Pose()</span><br><span class="line">pose_target.orientation.w = <span class="number">1.0</span></span><br><span class="line">pose_target.position.x =  <span class="number">0.7</span></span><br><span class="line">pose_target.position.y = <span class="number">-0.05</span></span><br><span class="line">pose_target.position.z = <span class="number">1.1</span></span><br><span class="line">group.set_pose_target(pose_target)</span><br><span class="line"></span><br><span class="line">plan1 = group.plan()</span><br></pre></td></tr></table></figure>

<p><strong>“move_group” C++ Interface:</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">moveit::<span class="function">planning_interface::MoveGroup <span class="title">group</span><span class="params">(<span class="string">"right_arm"</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">geometry_msgs::Pose target_pose;</span><br><span class="line">target_pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line">target_pose.<span class="built_in">position</span>.x = <span class="number">0.28</span>;</span><br><span class="line">target_pose.<span class="built_in">position</span>.y = <span class="number">-0.7</span>;</span><br><span class="line">target_pose.<span class="built_in">position</span>.z = <span class="number">1.0</span>;</span><br><span class="line">group.setPoseTarget(target_pose);</span><br><span class="line"></span><br><span class="line">moveit::planning_interface::MoveGroup::Plan my_plan;</span><br><span class="line"><span class="keyword">bool</span> success = group.plan(my_plan);</span><br></pre></td></tr></table></figure>

<h3 id="ROS编程流程"><a href="#ROS编程流程" class="headerlink" title="ROS编程流程"></a>ROS编程流程</h3><ul>
<li><p>（1）连接控制需要的规划组</p>
<ul>
<li>要控制谁？</li>
</ul>
</li>
<li><p>（2）设置目标位姿（关节空间或笛卡尔空间）</p>
<ul>
<li>要到达什么位置？终点的位姿？</li>
</ul>
</li>
<li><p>（3）设置运动约束（可选）</p>
<ul>
<li>针对场景做运动约束</li>
</ul>
</li>
<li><p>（4）使用MoveIt！规划一条到达目标的轨迹</p>
<ul>
<li>怎么走？</li>
</ul>
</li>
<li><p>（5）修改轨迹（如速度等参数）（可选）</p>
</li>
<li><p>（6）执行规划出的轨迹</p>
<ul>
<li>Execute</li>
</ul>
</li>
</ul>
<h2 id="5-2-关节空间运动"><a href="#5-2-关节空间运动" class="headerlink" title="5.2 关节空间运动"></a>5.2 关节空间运动</h2><p><strong>点到点运动：不需要在笛卡尔空间规划末端运动轨迹，机器人各个关节运动不需要联动。</strong></p>
<h3 id="正向运动学规划例程："><a href="#正向运动学规划例程：" class="headerlink" title="正向运动学规划例程："></a>正向运动学规划例程：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> roslaunch probot_anno_moveit_config demo.launch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rosrun probot_demo moveit_fk_demo.py</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># moveit_fk_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy, sys</span><br><span class="line"><span class="keyword">import</span> moveit_commander</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoveItFkDemo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 0.初始化move_group API和ROS节点</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化move_group的API</span></span><br><span class="line">        moveit_commander.roscpp_initialize(sys.argv)</span><br><span class="line">        <span class="comment"># 初始化ROS节点</span></span><br><span class="line">        rospy.init_node(<span class="string">'moveit_fk_demo'</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">		<span class="comment"># 1. 连接控制需要的规划组，设置参数约束</span></span><br><span class="line">        <span class="comment"># 初始化需要使用move group控制的机械臂中的arm group</span></span><br><span class="line">        arm = moveit_commander.MoveGroupCommander(<span class="string">'manipulator'</span>)        </span><br><span class="line">        <span class="comment"># 设置机械臂运动的允许误差值，单位是弧度</span></span><br><span class="line">        arm.set_goal_joint_tolerance(<span class="number">0.001</span>)</span><br><span class="line">        <span class="comment"># 设置允许的最大速度和加速度，0.5是一个比例，乘以允许的最大速度和加速度</span></span><br><span class="line">        arm.set_max_acceleration_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line">        arm.set_max_velocity_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 设置初始位姿和目标位姿</span></span><br><span class="line">        <span class="comment"># 控制机械臂先回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go() <span class="comment"># plan + execute</span></span><br><span class="line">        rospy.sleep(<span class="number">1</span>) <span class="comment"># 休眠一秒        </span></span><br><span class="line">        <span class="comment"># 设置机械臂的目标位置，使用六轴的位置数据进行描述（单位：弧度）</span></span><br><span class="line">        joint_positions = [<span class="number">0.391410</span>, <span class="number">-0.676384</span>, <span class="number">-0.376217</span>, <span class="number">0.0</span>, <span class="number">1.052834</span>, <span class="number">0.454125</span>]</span><br><span class="line">        arm.set_joint_value_target(joint_positions)     </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 执行规划出的轨迹，并回到原处</span></span><br><span class="line">        <span class="comment"># 控制机械臂完成运动</span></span><br><span class="line">        arm.go()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 控制机械臂先回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 关闭并退出moveit</span></span><br><span class="line">        moveit_commander.roscpp_shutdown()</span><br><span class="line">        moveit_commander.os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        MoveItFkDemo()</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>关键API的实现步骤</strong></p>
<ul>
<li>创建规划组的控制对象；</li>
<li>设置关节空间运动的目标位姿；</li>
<li>完成规划并控制机械臂完成运动</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arm = moveit_commander.MoveGroupCommander(<span class="string">'manipulator'</span>)</span><br><span class="line"></span><br><span class="line">joint_positions = [<span class="number">0.391410</span>, <span class="number">-0.676384</span>, <span class="number">-0.376217</span>, <span class="number">0.0</span>, <span class="number">1.052834</span>, <span class="number">0.454125</span>]</span><br><span class="line">arm.set_joint_value_target(joint_positions)</span><br><span class="line"></span><br><span class="line">arm.go()</span><br></pre></td></tr></table></figure>



<h3 id="逆向运动学规划例程："><a href="#逆向运动学规划例程：" class="headerlink" title="逆向运动学规划例程："></a>逆向运动学规划例程：</h3><p>很多情况下很难确定机器人目标位置的六个关节值，更常用的是通过工作空间下的 x y z 和姿态来确定目标位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> roslaunch probot_anno_moveit_config demo.launch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rosrun probot_demo moveit_ik_demo.py</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># moveit_ik_demo.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy, sys</span><br><span class="line"><span class="keyword">import</span> moveit_commander</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PoseStamped, Pose</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoveItIkDemo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 0. 初始化</span></span><br><span class="line">        <span class="comment"># 初始化move_group的API</span></span><br><span class="line">        moveit_commander.roscpp_initialize(sys.argv) </span><br><span class="line">        <span class="comment"># 初始化ROS节点</span></span><br><span class="line">        rospy.init_node(<span class="string">'moveit_ik_demo'</span>)             </span><br><span class="line">        <span class="comment"># 初始化需要使用move group控制的机械臂中的arm group</span></span><br><span class="line">        arm = moveit_commander.MoveGroupCommander(<span class="string">'manipulator'</span>)      </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 设置参考坐标系和约束参数</span></span><br><span class="line">        <span class="comment"># 获取终端link的名称</span></span><br><span class="line">        end_effector_link = arm.get_end_effector_link()                    </span><br><span class="line">        <span class="comment"># 设置目标位置所使用的参考坐标系</span></span><br><span class="line">        reference_frame = <span class="string">'base_link'</span></span><br><span class="line">        arm.set_pose_reference_frame(reference_frame)</span><br><span class="line">             </span><br><span class="line">        <span class="comment"># 当运动规划失败后，允许重新规划</span></span><br><span class="line">        arm.allow_replanning(<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置位置(单位：米)和姿态（单位：弧度）的允许误差</span></span><br><span class="line">        arm.set_goal_position_tolerance(<span class="number">0.001</span>)</span><br><span class="line">        arm.set_goal_orientation_tolerance(<span class="number">0.01</span>)</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># 设置允许的最大速度和加速度</span></span><br><span class="line">        arm.set_max_acceleration_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line">        arm.set_max_velocity_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 控制机械臂先回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">               </span><br><span class="line">        <span class="comment"># 设置机械臂工作空间中的目标位姿，位置使用x、y、z坐标描述，</span></span><br><span class="line">        <span class="comment"># 姿态使用四元数描述，基于base_link坐标系</span></span><br><span class="line">        target_pose = PoseStamped()</span><br><span class="line">        target_pose.header.frame_id = reference_frame</span><br><span class="line">        target_pose.header.stamp = rospy.Time.now()     </span><br><span class="line">        target_pose.pose.position.x = <span class="number">0.2593</span></span><br><span class="line">        target_pose.pose.position.y = <span class="number">0.0636</span></span><br><span class="line">        target_pose.pose.position.z = <span class="number">0.1787</span></span><br><span class="line">        target_pose.pose.orientation.x = <span class="number">0.70692</span></span><br><span class="line">        target_pose.pose.orientation.y = <span class="number">0.0</span></span><br><span class="line">        target_pose.pose.orientation.z = <span class="number">0.0</span></span><br><span class="line">        target_pose.pose.orientation.w = <span class="number">0.70729</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置机器臂当前的状态作为运动初始状态</span></span><br><span class="line">        arm.set_start_state_to_current_state()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置机械臂终端运动的目标位姿</span></span><br><span class="line">        arm.set_pose_target(target_pose, end_effector_link)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 规划运动路径，即rviz中的机械臂虚影轨迹</span></span><br><span class="line">        traj = arm.plan()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按照规划的运动路径控制机械臂运动</span></span><br><span class="line">        arm.execute(traj)</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 控制机械臂回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 关闭并退出moveit</span></span><br><span class="line">        moveit_commander.roscpp_shutdown()</span><br><span class="line">        moveit_commander.os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    MoveItIkDemo()</span><br></pre></td></tr></table></figure>

<p><strong>关键API的实现步骤：</strong></p>
<ul>
<li>创建规划组的控制对象；</li>
<li>获取机器人的终端link名称；</li>
<li>设置目标位姿对应的参考坐标系的起始、终止位姿；</li>
<li>完成规划并控制机械臂完成运动。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arm = moveit_commander.MoveGroupCommander(<span class="string">'manipulator'</span>)</span><br><span class="line">end_effortor_link = arm.get_end_effector_link()</span><br><span class="line"></span><br><span class="line">reference_frame = <span class="string">'base_link'</span></span><br><span class="line">arm.set_pose_reference_frame(reference_frame)</span><br><span class="line"></span><br><span class="line">arm.set_pose_target(target_pose, end_effector_link)</span><br><span class="line"></span><br><span class="line">traj = arm.plan()</span><br><span class="line">arm.execute(traj)</span><br></pre></td></tr></table></figure>



<h2 id="5-3-笛卡尔空间运动"><a href="#5-3-笛卡尔空间运动" class="headerlink" title="5.3 笛卡尔空间运动"></a>5.3 笛卡尔空间运动</h2><p><strong>笛卡尔路径约束，路径点之间的路径形状是一条直线</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> roslaunch probot_anno_moveit_config demo.launch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rosrun probot_demo moveit_cartesian_demo.py _cartesian:=True (走直线)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rosrun probot_demo moveit_cartesian_demo.py _cartesian:=False (自由曲线)</span></span><br></pre></td></tr></table></figure>

<p><strong>显示终端轨迹：</strong></p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130095029.png" alt="image-20201130095029187" style="zoom:67%;" />



<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130095002.png" alt="image-20201130095002467" style="zoom:67%;" />



<p><strong>走直线：</strong></p>
<p>两点可以确定一条直线，所以在代码中用 列表 <code>waypoints[]</code> 来储存路点列表</p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130095310.png" alt="image-20201130095310643" style="zoom: 67%;" />

<p><strong>自由曲线：</strong></p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130095832.png" alt="image-20201130095832715" style="zoom: 80%;" />

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy, sys</span><br><span class="line"><span class="keyword">import</span> moveit_commander</span><br><span class="line"><span class="keyword">from</span> moveit_commander <span class="keyword">import</span> MoveGroupCommander</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Pose</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoveItCartesianDemo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 初始化move_group的API</span></span><br><span class="line">        moveit_commander.roscpp_initialize(sys.argv)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化ROS节点</span></span><br><span class="line">        rospy.init_node(<span class="string">'moveit_cartesian_demo'</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 是否需要使用笛卡尔空间的运动规划</span></span><br><span class="line">        cartesian = rospy.get_param(<span class="string">'~cartesian'</span>, <span class="literal">True</span>)</span><br><span class="line">                      </span><br><span class="line">        <span class="comment"># 初始化需要使用move group控制的机械臂中的arm group</span></span><br><span class="line">        arm = MoveGroupCommander(<span class="string">'manipulator'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 当运动规划失败后，允许重新规划</span></span><br><span class="line">        arm.allow_replanning(<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置目标位置所使用的参考坐标系</span></span><br><span class="line">        arm.set_pose_reference_frame(<span class="string">'base_link'</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="comment"># 设置位置(单位：米)和姿态（单位：弧度）的允许误差</span></span><br><span class="line">        arm.set_goal_position_tolerance(<span class="number">0.001</span>)</span><br><span class="line">        arm.set_goal_orientation_tolerance(<span class="number">0.001</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置允许的最大速度和加速度</span></span><br><span class="line">        arm.set_max_acceleration_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line">        arm.set_max_velocity_scaling_factor(<span class="number">0.5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取终端link的名称</span></span><br><span class="line">        end_effector_link = arm.get_end_effector_link()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 控制机械臂先回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">                                               </span><br><span class="line">        <span class="comment"># 获取当前位姿数据最为机械臂运动的起始位姿</span></span><br><span class="line">        start_pose = arm.get_current_pose(end_effector_link).pose</span><br><span class="line">                </span><br><span class="line">        <span class="comment"># 初始化路点列表</span></span><br><span class="line">        waypoints = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将初始位姿加入路点列表</span></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            waypoints.append(start_pose)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 设置路点数据，并加入路点列表</span></span><br><span class="line">        wpose = deepcopy(start_pose)</span><br><span class="line">        wpose.position.z -= <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            waypoints.append(deepcopy(wpose))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arm.set_pose_target(wpose)</span><br><span class="line">            arm.go()</span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        wpose.position.x += <span class="number">0.15</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            waypoints.append(deepcopy(wpose))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arm.set_pose_target(wpose)</span><br><span class="line">            arm.go()</span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        wpose.position.y += <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            waypoints.append(deepcopy(wpose))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arm.set_pose_target(wpose)</span><br><span class="line">            arm.go()</span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        wpose.position.x -= <span class="number">0.15</span></span><br><span class="line">        wpose.position.y -= <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            waypoints.append(deepcopy(wpose))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arm.set_pose_target(wpose)</span><br><span class="line">            arm.go()</span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cartesian:</span><br><span class="line">            fraction = <span class="number">0.0</span>   <span class="comment">#路径规划覆盖率</span></span><br><span class="line">            maxtries = <span class="number">100</span>   <span class="comment">#最大尝试规划次数</span></span><br><span class="line">            attempts = <span class="number">0</span>     <span class="comment">#已经尝试规划次数</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 设置机器臂当前的状态作为运动初始状态</span></span><br><span class="line">            arm.set_start_state_to_current_state()</span><br><span class="line">        </span><br><span class="line">            <span class="comment"># 尝试规划一条笛卡尔空间下的路径，依次通过所有路点</span></span><br><span class="line">            <span class="keyword">while</span> fraction &lt; <span class="number">1.0</span> <span class="keyword">and</span> attempts &lt; maxtries:</span><br><span class="line">                <span class="comment"># 返回的fraction是一个比例，成功规划的轨迹的百分比，所以fraction最好等于1，这里设置了求解100次</span></span><br><span class="line">                (plan, fraction) = arm.compute_cartesian_path (</span><br><span class="line">                                        waypoints,   <span class="comment"># waypoint poses，路点列表</span></span><br><span class="line">                                        <span class="number">0.01</span>,        <span class="comment"># eef_step，终端步进值, 每隔1厘米算一次运动学逆解，是否能到达这个点</span></span><br><span class="line">                                        <span class="number">0.0</span>,         <span class="comment"># jump_threshold，跳跃阈值，遇到逆解求不出的点，是否跳过，0.0是默认不跳过，如果是10，则允许跳过10厘米，10厘米内有点求不到都可以跳过</span></span><br><span class="line">                                        <span class="literal">True</span>)        <span class="comment"># avoid_collisions，避障规划</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 尝试次数累加</span></span><br><span class="line">                attempts += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 打印运动规划进程</span></span><br><span class="line">                <span class="keyword">if</span> attempts % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">                    rospy.loginfo(<span class="string">"Still trying after "</span> + str(attempts) + <span class="string">" attempts..."</span>)</span><br><span class="line">                        </span><br><span class="line">            <span class="comment"># 如果路径规划成功（覆盖率100%）,则开始控制机械臂运动</span></span><br><span class="line">            <span class="keyword">if</span> fraction == <span class="number">1.0</span>:</span><br><span class="line">                rospy.loginfo(<span class="string">"Path computed successfully. Moving the arm."</span>)</span><br><span class="line">                arm.execute(plan)</span><br><span class="line">                rospy.loginfo(<span class="string">"Path execution complete."</span>)</span><br><span class="line">            <span class="comment"># 如果路径规划失败，则打印失败信息</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rospy.loginfo(<span class="string">"Path planning failed with only "</span> + str(fraction) + <span class="string">" success after "</span> + str(maxtries) + <span class="string">" attempts."</span>)  </span><br><span class="line"></span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 控制机械臂先回到初始化位置</span></span><br><span class="line">            arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">            arm.go()</span><br><span class="line">            rospy.sleep(<span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 关闭并退出moveit</span></span><br><span class="line">            moveit_commander.roscpp_shutdown()</span><br><span class="line">            moveit_commander.os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        MoveItCartesianDemo()</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>关键 API 的实现步骤：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(plan, fraction) = arm.compute_cartesian_path(</span><br><span class="line">					waypoints, <span class="comment"># waypoint poses, 路点列表</span></span><br><span class="line">					<span class="number">0.01</span>,      <span class="comment"># eef_step, 终端步进值</span></span><br><span class="line">					<span class="number">0.0</span>,       <span class="comment"># jump_threshold，最小移动值</span></span><br><span class="line">					<span class="literal">True</span>)      <span class="comment"># avoid_collisions，避障规划</span></span><br></pre></td></tr></table></figure>

<p>返回值：</p>
<ul>
<li>plan：规划出来的运动轨迹</li>
<li>fraction：描述规划成功的轨迹在给定路点列表中的覆盖率 [0~1]。如果fraction小于1，说明给定的路点列表没办法完成规划。</li>
</ul>
<p><strong>ROS中没有直接走圆弧的API，如何在笛卡尔空间下走出圆弧轨迹？</strong></p>
<h2 id="5-4-自主避障运动"><a href="#5-4-自主避障运动" class="headerlink" title="5.4 自主避障运动"></a>5.4 自主避障运动</h2><h3 id="5-4-1-规划场景监听器："><a href="#5-4-1-规划场景监听器：" class="headerlink" title="5.4.1 规划场景监听器："></a>5.4.1 规划场景监听器：</h3><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130102622.png" alt="image-20201130102622853" style="zoom:80%;" />

<p><strong>监听信息：</strong></p>
<ul>
<li>状态信息（State Information）：<ul>
<li>机器人的关节话题 joint_states;</li>
</ul>
</li>
<li>传感器信息（Sensor Information）：<ul>
<li>机器人的传感器数据；</li>
</ul>
</li>
<li>外界环境信息（World geometry information）<ul>
<li>周围环境信息。</li>
</ul>
</li>
</ul>
<p><strong>添加场景物体：</strong></p>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130104336.png" alt="image-20201130104336092"></p>
<p>点击 <code>Scene Objects</code> -&gt; <code>Import File</code> ，可以选择/home/your_name/.gazebo/models中的模型，</p>
<p>这里选择了 <code>bowl</code> -&gt;<code>meshes</code> -&gt;<code>bowl.dae</code> ，可以拖动Scale的拖动条调整模型的大小。设完成后点击 <code>Publish Scene</code>将模型发布出去，点击<code>Planning</code> 返回路径规划</p>
<p><strong>碰撞：</strong></p>
<ul>
<li>拖动机械臂，当和盘子发生碰撞后会，碰撞部分会变成红色</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130104727.png" alt="image-20201130104727667" style="zoom: 80%;" />

<p><strong>避障运动：</strong></p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130105017.png" alt="image-20201130105017738" style="zoom:80%;" />

<p><strong>当机器人末端抓取物体时，物体和机器人视为一体，也会考虑到物体的避障：</strong></p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201130113953.png" alt="image-20201130113953680" style="zoom:80%;" />

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy, sys</span><br><span class="line"><span class="keyword">import</span> thread, copy</span><br><span class="line"><span class="keyword">import</span> moveit_commander</span><br><span class="line"><span class="keyword">from</span> moveit_commander <span class="keyword">import</span> RobotCommander, MoveGroupCommander, PlanningSceneInterface</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> PoseStamped, Pose</span><br><span class="line"><span class="keyword">from</span> moveit_msgs.msg <span class="keyword">import</span> CollisionObject, AttachedCollisionObject, PlanningScene</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> radians</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoveAttachedObjectDemo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 初始化move_group的API</span></span><br><span class="line">        moveit_commander.roscpp_initialize(sys.argv)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化ROS节点</span></span><br><span class="line">        rospy.init_node(<span class="string">'moveit_attached_object_demo'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化场景对象,场景监听器！</span></span><br><span class="line">        scene = PlanningSceneInterface()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">                                </span><br><span class="line">        <span class="comment"># 初始化需要使用move group控制的机械臂中的arm group</span></span><br><span class="line">        arm = MoveGroupCommander(<span class="string">'manipulator'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取终端link的名称</span></span><br><span class="line">        end_effector_link = arm.get_end_effector_link()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置位置(单位：米)和姿态（单位：弧度）的允许误差</span></span><br><span class="line">        arm.set_goal_position_tolerance(<span class="number">0.01</span>)</span><br><span class="line">        arm.set_goal_orientation_tolerance(<span class="number">0.05</span>)</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># 当运动规划失败后，允许重新规划</span></span><br><span class="line">        arm.allow_replanning(<span class="literal">True</span>)</span><br><span class="line">        arm.set_planning_time(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 控制机械臂回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 移除场景中之前运行残留的物体</span></span><br><span class="line">        scene.remove_attached_object(end_effector_link, <span class="string">'tool'</span>)</span><br><span class="line">        scene.remove_world_object(<span class="string">'table'</span>) </span><br><span class="line">        scene.remove_world_object(<span class="string">'target'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置桌面的高度</span></span><br><span class="line">        table_ground = <span class="number">0.6</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置table和tool的三维尺寸，长宽高</span></span><br><span class="line">        table_size = [<span class="number">0.1</span>, <span class="number">0.7</span>, <span class="number">0.01</span>]</span><br><span class="line">        tool_size = [<span class="number">0.2</span>, <span class="number">0.02</span>, <span class="number">0.02</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置tool的位姿， 要和机器人的终端连接</span></span><br><span class="line">        p = PoseStamped()</span><br><span class="line">        p.header.frame_id = end_effector_link</span><br><span class="line">        </span><br><span class="line">        p.pose.position.x = tool_size[<span class="number">0</span>] / <span class="number">2.0</span> - <span class="number">0.025</span></span><br><span class="line">        p.pose.position.y = <span class="number">-0.015</span></span><br><span class="line">        p.pose.position.z = <span class="number">0.0</span></span><br><span class="line">        p.pose.orientation.x = <span class="number">0</span></span><br><span class="line">        p.pose.orientation.y = <span class="number">0</span></span><br><span class="line">        p.pose.orientation.z = <span class="number">0</span></span><br><span class="line">        p.pose.orientation.w = <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 将tool附着到机器人的终端</span></span><br><span class="line">        scene.attach_box(end_effector_link, <span class="string">'tool'</span>, p, tool_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将table加入场景当中</span></span><br><span class="line">        table_pose = PoseStamped()</span><br><span class="line">        table_pose.header.frame_id = <span class="string">'base_link'</span></span><br><span class="line">        table_pose.pose.position.x = <span class="number">0.25</span></span><br><span class="line">        table_pose.pose.position.y = <span class="number">0.0</span></span><br><span class="line">        table_pose.pose.position.z = table_ground + table_size[<span class="number">2</span>] / <span class="number">2.0</span></span><br><span class="line">        table_pose.pose.orientation.w = <span class="number">1.0</span></span><br><span class="line">        scene.add_box(<span class="string">'table'</span>, table_pose, table_size)</span><br><span class="line">        </span><br><span class="line">        rospy.sleep(<span class="number">2</span>)  </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新当前的位姿</span></span><br><span class="line">        arm.set_start_state_to_current_state()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置机械臂的目标位置，使用六轴的位置数据进行描述（单位：弧度）</span></span><br><span class="line">        joint_positions = [<span class="number">0.827228546495185</span>, <span class="number">0.29496592875743577</span>, <span class="number">1.1185644936946095</span>, <span class="number">-0.7987583317769674</span>, <span class="number">-0.18950024740190782</span>, <span class="number">0.11752152218233858</span>]</span><br><span class="line">        arm.set_joint_value_target(joint_positions)</span><br><span class="line">                 </span><br><span class="line">        <span class="comment"># 控制机械臂完成运动</span></span><br><span class="line">        arm.go()</span><br><span class="line">        rospy.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 控制机械臂回到初始化位置</span></span><br><span class="line">        arm.set_named_target(<span class="string">'home'</span>)</span><br><span class="line">        arm.go()</span><br><span class="line"></span><br><span class="line">        moveit_commander.roscpp_shutdown()</span><br><span class="line">        moveit_commander.os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    MoveAttachedObjectDemo()</span><br></pre></td></tr></table></figure>

<p><strong>关键API:</strong></p>
<ul>
<li>add_box</li>
<li>attach_box</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MoveIt/" rel="tag">MoveIt!</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ROS/" rel="tag">ROS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ROS MoviIt!教程 - 4.MoveIt!仿真" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%204.MoveIt!%E4%BB%BF%E7%9C%9F/"
    >ROS MoviIt!学习 - 4.MoveIt！仿真</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%204.MoveIt!%E4%BB%BF%E7%9C%9F/" class="article-date">
  <time datetime="2021-05-27T09:29:19.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="四、MoveIt！仿真"><a href="#四、MoveIt！仿真" class="headerlink" title="四、MoveIt！仿真"></a>四、MoveIt！仿真</h1><h2 id="4-1-ROS中的控制器插件"><a href="#4-1-ROS中的控制器插件" class="headerlink" title="4.1 ROS中的控制器插件"></a>4.1 ROS中的控制器插件</h2><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201128172311.png" alt="image-20201128172311181" style="zoom: 50%;" />

<h3 id="ros-control-（上图感叹号部分）是什么？"><a href="#ros-control-（上图感叹号部分）是什么？" class="headerlink" title="ros_control （上图感叹号部分）是什么？"></a>ros_control （上图感叹号部分）是什么？</h3><ul>
<li>ROS为开发者提供的机器人控制中间件。</li>
<li>包含一系列控制器接口、传动装置接口、硬件接口、控制器工具箱等等。</li>
<li>可以帮助机器人应用功能包快速落地，提高开发效率。</li>
</ul>
<h2 id="4-2-完善机器人模型"><a href="#4-2-完善机器人模型" class="headerlink" title="4.2 完善机器人模型"></a>4.2 完善机器人模型</h2><br>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- these are the arguments you can pass this launch file, for example paused:=true --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"paused"</span> <span class="attr">default</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"use_sim_time"</span> <span class="attr">default</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"gui"</span> <span class="attr">default</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"headless"</span> <span class="attr">default</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"debug"</span> <span class="attr">default</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- We resume the logic in empty_world.launch --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find gazebo_ros)/launch/empty_world.launch"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"debug"</span> <span class="attr">value</span>=<span class="string">"$(arg debug)"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"gui"</span> <span class="attr">value</span>=<span class="string">"$(arg gui)"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"paused"</span> <span class="attr">value</span>=<span class="string">"$(arg paused)"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"use_sim_time"</span> <span class="attr">value</span>=<span class="string">"$(arg use_sim_time)"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"headless"</span> <span class="attr">value</span>=<span class="string">"$(arg headless)"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Load the URDF into the ROS Parameter Server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"robot_description"</span> <span class="attr">command</span>=<span class="string">"$(find xacro)/xacro --inorder '$(find probot_description)/urdf/probot_anno.xacro'"</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Run a python script to the send a service call to gazebo_ros to spawn a URDF robot --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"urdf_spawner"</span> <span class="attr">pkg</span>=<span class="string">"gazebo_ros"</span> <span class="attr">type</span>=<span class="string">"spawn_model"</span> <span class="attr">respawn</span>=<span class="string">"false"</span> <span class="attr">output</span>=<span class="string">"screen"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">args</span>=<span class="string">"-urdf -model probot_anno -param robot_description"</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="（1）为link添加惯性参数和碰撞属性"><a href="#（1）为link添加惯性参数和碰撞属性" class="headerlink" title="（1）为link添加惯性参数和碰撞属性"></a>（1）为link添加惯性参数和碰撞属性</h3><h3 id="（2）为joint添加传动装置"><a href="#（2）为joint添加传动装置" class="headerlink" title="（2）为joint添加传动装置"></a>（2）为joint添加传动装置</h3><h3 id="（3）添加gazebo控制器插件"><a href="#（3）添加gazebo控制器插件" class="headerlink" title="（3）添加gazebo控制器插件"></a>（3）添加gazebo控制器插件</h3><h2 id="4-3-构建MoveIt！-Gazebo-仿真"><a href="#4-3-构建MoveIt！-Gazebo-仿真" class="headerlink" title="4.3 构建MoveIt！+ Gazebo 仿真"></a>4.3 构建MoveIt！+ Gazebo 仿真</h2><p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201128192232.png" alt="image-20201128192232714"></p>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201128193748.png" alt="image-20201128193748192"></p>
<h3 id="Gazebo-端"><a href="#Gazebo-端" class="headerlink" title="Gazebo 端"></a>Gazebo 端</h3><h4 id="Joint-Trajectory-Controller-配置Gazebo-关节轨迹控制器接口："><a href="#Joint-Trajectory-Controller-配置Gazebo-关节轨迹控制器接口：" class="headerlink" title="Joint Trajectory Controller 配置Gazebo 关节轨迹控制器接口："></a>Joint Trajectory Controller 配置Gazebo 关节轨迹控制器接口：</h4><p>（1） 参数配置：probot_gazebo/config/probot_anno_trajectory_control.yaml</p>
<ul>
<li>joints要和机器人模型关节名称匹配</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">probot_anno:</span></span><br><span class="line">  <span class="attr">arm_joint_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">"position_controllers/JointTrajectoryController"</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_6</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gains:</span></span><br><span class="line">      <span class="attr">joint_1:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">joint_2:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">joint_3:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">joint_4:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">joint_5:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">joint_6:</span>   <span class="string">&#123;p:</span> <span class="number">1000.0</span><span class="string">,</span> <span class="attr">i:</span> <span class="number">0.0</span><span class="string">,</span> <span class="attr">d:</span> <span class="number">0.1</span><span class="string">,</span> <span class="attr">i_clamp:</span> <span class="number">0.0</span><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>（2）控制器启动：probot_gazebo/launch/probot_anno/probot_anno_trajectory_controller.launch</p>
<ul>
<li>加载上述配置文件，</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find probot_gazebo)/config/probot_anno_trajectory_control.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"arm_controller_spawner"</span> <span class="attr">pkg</span>=<span class="string">"controller_manager"</span> <span class="attr">type</span>=<span class="string">"spawner"</span> <span class="attr">respawn</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">output</span>=<span class="string">"screen"</span> <span class="attr">ns</span>=<span class="string">"/probot_anno"</span> <span class="attr">args</span>=<span class="string">"arm_joint_controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Joint State Controller 配置Gazebo 关节状态控制器接口：</p>
<p>（1）参数配置：probot_gazebo/config/probot_anno_gazebo_joint_states.yaml</p>
<ul>
<li>发布频率为50Hz，即一秒钟50次</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">probot_anno:</span></span><br><span class="line">  <span class="comment"># Publish all joint states -----------------------------------</span></span><br><span class="line">  <span class="attr">joint_state_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">joint_state_controller/JointStateController</span></span><br><span class="line">    <span class="attr">publish_rate:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<p>（2）控制器启动：probot_gazebo/launch/probot_anno/probot_anno_gazebo_states.launch</p>
<ul>
<li><p>spawner</p>
</li>
<li><p>robot_state_publisher通过各个关节的位置，发布成tf</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将关节控制器的配置参数加载到参数服务器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find probot_gazebo)/config/probot_anno_gazebo_joint_states.yaml"</span> <span class="attr">command</span>=<span class="string">"load"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"joint_controller_spawner"</span> <span class="attr">pkg</span>=<span class="string">"controller_manager"</span> <span class="attr">type</span>=<span class="string">"spawner"</span> <span class="attr">respawn</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">output</span>=<span class="string">"screen"</span> <span class="attr">ns</span>=<span class="string">"/probot_anno"</span> <span class="attr">args</span>=<span class="string">"joint_state_controller"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 运行robot_state_publisher节点，发布tf  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">pkg</span>=<span class="string">"robot_state_publisher"</span> <span class="attr">type</span>=<span class="string">"robot_state_publisher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">respawn</span>=<span class="string">"false"</span> <span class="attr">output</span>=<span class="string">"screen"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">"/joint_states"</span> <span class="attr">to</span>=<span class="string">"/probot_anno/joint_states"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="MoveIt！端："><a href="#MoveIt！端：" class="headerlink" title="MoveIt！端："></a>MoveIt！端：</h3><p>Follow Joint Trajectory 控制器接口：</p>
<p>（1）参数配置：probot_anno_moveit_config/config/controllers_gazebo.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">controller_manager_ns:</span> <span class="string">controller_manager</span></span><br><span class="line"><span class="attr">controller_list:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">probot_anno/arm_joint_controller</span></span><br><span class="line">    <span class="attr">action_ns:</span> <span class="string">follow_joint_trajectory</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">FollowJointTrajectory</span></span><br><span class="line">    <span class="attr">default:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_6</span></span><br></pre></td></tr></table></figure>

<p>（2）控制器启动：probot_anno_moveit_config/launch/probot_anno_moveit_controller_manager.launch</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- loads moveit_controller_manager on the parameter server which is taken as argument </span></span><br><span class="line"><span class="comment">    if no argument is passed, moveit_simple_controller_manager will be set --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">"moveit_controller_manager"</span> <span class="attr">default</span>=<span class="string">"moveit_simple_controller_manager/MoveItSimpleControllerManager"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"moveit_controller_manager"</span> <span class="attr">value</span>=<span class="string">"$(arg moveit_controller_manager)"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- loads ros_controllers to the param server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">"$(find probot_anno_moveit_config)/config/ros_controllers.yaml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）最顶层lanch文件  probot_gazebo/launch/probot_anno/probot_anno_bringup_moveit.launch</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- Launch Gazebo  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find probot_gazebo)/launch/probot_anno/probot_anno_gazebo_world.launch"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ros_control arm launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find probot_gazebo)/launch/probot_anno/probot_anno_gazebo_states.launch"</span> /&gt;</span>   </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ros_control trajectory control dof arm launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find probot_gazebo)/launch/probot_anno/probot_anno_trajectory_controller.launch"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- moveit launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"$(find probot_anno_moveit_config)/launch/moveit_planning_execution.launch"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="查看话题"><a href="#查看话题" class="headerlink" title="查看话题"></a>查看话题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rostopic list</span></span><br><span class="line">/attached_collision_object</span><br><span class="line">/clock</span><br><span class="line">/collision_object</span><br><span class="line">/execute_trajectory/cancel</span><br><span class="line">/execute_trajectory/feedback</span><br><span class="line">/execute_trajectory/goal</span><br><span class="line">/execute_trajectory/result</span><br><span class="line">/execute_trajectory/status</span><br><span class="line">/gazebo/link_states</span><br><span class="line">/gazebo/model_states</span><br><span class="line">/gazebo/parameter_descriptions</span><br><span class="line">/gazebo/parameter_updates</span><br><span class="line">/gazebo/set_link_state</span><br><span class="line">/gazebo/set_model_state</span><br><span class="line">/gazebo_gui/parameter_descriptions</span><br><span class="line">/gazebo_gui/parameter_updates</span><br><span class="line">/joint_states</span><br><span class="line">/move_group/cancel</span><br><span class="line">/move_group/display_contacts</span><br><span class="line">/move_group/display_planned_path</span><br><span class="line">/move_group/feedback</span><br><span class="line">/move_group/goal</span><br><span class="line">/move_group/monitored_planning_scene</span><br><span class="line">/move_group/ompl/parameter_descriptions</span><br><span class="line">/move_group/ompl/parameter_updates</span><br><span class="line">/move_group/plan_execution/parameter_descriptions</span><br><span class="line">/move_group/plan_execution/parameter_updates</span><br><span class="line">/move_group/planning_scene_monitor/parameter_descriptions</span><br><span class="line">/move_group/planning_scene_monitor/parameter_updates</span><br><span class="line">/move_group/result</span><br><span class="line">/move_group/sense_for_plan/parameter_descriptions</span><br><span class="line">/move_group/sense_for_plan/parameter_updates</span><br><span class="line">/move_group/status</span><br><span class="line">/move_group/trajectory_execution/parameter_descriptions</span><br><span class="line">/move_group/trajectory_execution/parameter_updates</span><br><span class="line">/pickup/cancel</span><br><span class="line">/pickup/feedback</span><br><span class="line">/pickup/goal</span><br><span class="line">/pickup/result</span><br><span class="line">/pickup/status</span><br><span class="line">/place/cancel</span><br><span class="line">/place/feedback</span><br><span class="line">/place/goal</span><br><span class="line">/place/result</span><br><span class="line">/place/status</span><br><span class="line">/planning_scene</span><br><span class="line">/planning_scene_world</span><br><span class="line">/probot_anno/arm_joint_controller/command</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/cancel</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/feedback</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/goal</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/result</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/status</span><br><span class="line">/probot_anno/arm_joint_controller/state</span><br><span class="line">/probot_anno/joint_states</span><br><span class="line">/recognized_object_array</span><br><span class="line">/rosout</span><br><span class="line">/rosout_agg</span><br><span class="line">/rviz_moveit_motion_planning_display/robot_interaction_interactive_marker_topic/feedback</span><br><span class="line">/rviz_moveit_motion_planning_display/robot_interaction_interactive_marker_topic/update</span><br><span class="line">/rviz_moveit_motion_planning_display/robot_interaction_interactive_marker_topic/update_full</span><br><span class="line">/rviz_zz_23863_4329036234228615542/motionplanning_planning_scene_monitor/parameter_descriptions</span><br><span class="line">/rviz_zz_23863_4329036234228615542/motionplanning_planning_scene_monitor/parameter_updates</span><br><span class="line">/tf</span><br><span class="line">/tf_static</span><br><span class="line">/trajectory_execution_event</span><br></pre></td></tr></table></figure>

<p>其中以下话题是action中的底层话题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/probot_anno/arm_joint_controller/command</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/cancel</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/feedback</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/goal</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/result</span><br><span class="line">/probot_anno/arm_joint_controller/follow_joint_trajectory/status</span><br><span class="line">/probot_anno/arm_joint_controller/state</span><br></pre></td></tr></table></figure>

<p>查看 /probot_anno/arm_joint_controller/follow_joint_trajectory/goal,输入完命令后移动机械臂，即可产生如下数据</p>
<ul>
<li>points为路径点，每个点前面有 横线 - 做区分，具体到每个点，包含：<ul>
<li>positions 位置</li>
<li>velocities 速度</li>
<li>accelerations 加速度</li>
<li>effort 力</li>
<li>time_from_start 具体的时间戳</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rostopic <span class="built_in">echo</span> /probot_anno/arm_joint_controller/follow_joint_trajectory/goal </span></span><br><span class="line">WARNING: no messages received and simulated time is active.</span><br><span class="line">Is /clock being published?</span><br><span class="line">header: </span><br><span class="line">  seq: 2</span><br><span class="line">  stamp: </span><br><span class="line">    secs: 389</span><br><span class="line">    nsecs: 400000000</span><br><span class="line">  frame_id: ''</span><br><span class="line">goal_id: </span><br><span class="line">  stamp: </span><br><span class="line">    secs: 389</span><br><span class="line">    nsecs: 400000000</span><br><span class="line">  id: "/move_group-3-389.400000000"</span><br><span class="line">goal: </span><br><span class="line">  trajectory: </span><br><span class="line">    header: </span><br><span class="line">      seq: 0</span><br><span class="line">      stamp: </span><br><span class="line">        secs: 0</span><br><span class="line">        nsecs:         0</span><br><span class="line">      frame_id: "/base_footprint"</span><br><span class="line">    joint_names: [joint_1, joint_2, joint_3, joint_4, joint_5, joint_6]</span><br><span class="line">    points: </span><br><span class="line">      - </span><br><span class="line">        positions: [-0.38825146074406547, -0.6524099587144567, 0.23720395399686023, -0.00010076182596829852, 0.41527452247959395, -0.4205500648974132]</span><br><span class="line">        velocities: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]</span><br><span class="line">        accelerations: [0.18853085881196788, 0.0, 0.0, 0.0, 0.0, 0.0]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs:         0</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.3833404759085481, -0.6500887017485557, 0.21245823433821254, -9.728456004470945e-05, 0.4376934801403612, -0.4156516645929134]</span><br><span class="line">        velocities: [0.03704071971723571, 0.017507899442853546, -0.18664265860651663, 2.6227006755639408e-05, 0.1690932378897403, 0.036945801874519915]</span><br><span class="line">        accelerations: [0.19304937300694633, 0.09124793027546448, -0.9727469794160399, 0.0001366903032305051, 0.8812826479486298, 0.19255467878492755]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 228248573</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.37842949107303064, -0.6477674447826548, 0.18771251467956485, -9.380729412112035e-05, 0.4601124378011285, -0.41075326428841363]</span><br><span class="line">        velocities: [0.06071112935119913, 0.028696104067553754, -0.3059143201215745, 4.2987048086311585e-05, 0.2771501611282206, 0.060555555445755645]</span><br><span class="line">        accelerations: [0.19777238056535099, 0.09348033671984872, -0.99654550962956, 0.00014003447019289163, 0.9028434774013626, 0.19726558350916512]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 321674600</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.37351850623751326, -0.6454461878167538, 0.16296679502091718, -9.033002819753128e-05, 0.4825313954618957, -0.40585486398391385]</span><br><span class="line">        velocities: [0.07471294534238421, 0.0353142904381858, -0.37646738123550494, 5.2901156813015434e-05, 0.34106934035475733, 0.07452149140604183]</span><br><span class="line">        accelerations: [0.17709037510708867, 0.08370464999978182, -0.8923319707590027, 0.00012539039467235737, 0.8084288090124003, 0.17663657624736975]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 392996344</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.3686075214019959, -0.6431249308508529, 0.1382210753622695, -8.68527622739422e-05, 0.504950353122663, -0.40095646367941407]</span><br><span class="line">        velocities: [0.08390947881602044, 0.03966118176503915, -0.4228073408957519, 5.941284307026924e-05, 0.38305209971498744, 0.08369445851475696]</span><br><span class="line">        accelerations: [0.11396632213572863, 0.05386803828481429, -0.5742592886260354, 8.06948548350701e-05, 0.5202634983181627, 0.11367428036325394]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 453950028</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.36369653656647843, -0.6408036738849519, 0.1134753557036218, -8.33754963503531e-05, 0.5273693107834302, -0.3960580633749143]</span><br><span class="line">        velocities: [0.08195650182511957, 0.038738075382875936, -0.41296658130571906, 5.803002056776447e-05, 0.37413663572193956, 0.08174648608003815]</span><br><span class="line">        accelerations: [-0.17593760660747473, -0.08315977519377366, 0.8865233423313901, -0.00012457416681668537, -0.8031663476015668, -0.17548676174809327]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 510236493</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.35878555173096105, -0.6384824169190509, 0.08872963604497414, -7.989823042676403e-05, 0.5497882684441975, -0.3911596630704145]</span><br><span class="line">        velocities: [0.0700862772951628, 0.033127420432835286, -0.35315429144094, 4.9625203887238066e-05, 0.3199483068889408, 0.06990667932040419]</span><br><span class="line">        accelerations: [-0.1860688585003218, -0.08794847640483491, 0.9375732086064174, -0.00013174768865604176, -0.849416155907665, -0.18559205203489088]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 574295741</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.35387456689544367, -0.6361611599531499, 0.06398391638632642, -7.642096450317495e-05, 0.5722072261049648, -0.3862612627659147]</span><br><span class="line">        velocities: [0.05807286460800233, 0.02744908526823965, -0.29262049782176214, 4.1119001575034046e-05, 0.26510631502471416, 0.05792405132707824]</span><br><span class="line">        accelerations: [-0.12744797836768276, -0.06024036267359057, 0.6421913423432557, -9.024065987807033e-05, -0.5818081152096802, -0.1271213894877366]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 651622654</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.3489635820599262, -0.633839902987249, 0.039238196727678754, -7.294369857958587e-05, 0.594626183765732, -0.38136286246141493]</span><br><span class="line">        velocities: [0.03728809803654459, 0.017624826834434084, -0.18788916103816172, 2.6402165146222526e-05, 0.1702225356278774, 0.03719254628021744]</span><br><span class="line">        accelerations: [-0.19358393084868963, -0.09150059774551014, 0.9754405366018473, -0.0001370688016029357, -0.883722938444857, -0.1930878668077922]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 744922922</span><br><span class="line">      - </span><br><span class="line">        positions: [-0.34405259722440884, -0.631518646021348, 0.014492477069031054, -6.946643265599678e-05, 0.6170451414264992, -0.37646446215691515]</span><br><span class="line">        velocities: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]</span><br><span class="line">        accelerations: [-0.19603285285189084, -0.09265812061501942, 0.9877802890928218, -0.00013880278232502834, -0.8949024229155365, -0.19553051338235275]</span><br><span class="line">        effort: []</span><br><span class="line">        time_from_start: </span><br><span class="line">          secs: 0</span><br><span class="line">          nsecs: 968761461</span><br><span class="line">  path_tolerance: []</span><br><span class="line">  goal_tolerance: []</span><br><span class="line">  goal_time_tolerance: </span><br><span class="line">    secs: 0</span><br><span class="line">    nsecs:         0</span><br><span class="line">---</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MoveIt/" rel="tag">MoveIt!</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ROS/" rel="tag">ROS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ROS MoviIt!教程 - 3.MoveIt!入门" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%203.MoveIt!%E5%85%A5%E9%97%A8/"
    >ROS MoviIt!学习 - 3.MoveIt！入门</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%203.MoveIt!%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2021-05-27T09:29:18.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="三、MoveIt！入门"><a href="#三、MoveIt！入门" class="headerlink" title="三、MoveIt！入门"></a>三、MoveIt！入门</h1><h2 id="3-1-MoveIt！简介"><a href="#3-1-MoveIt！简介" class="headerlink" title="3.1 MoveIt！简介"></a>3.1 MoveIt！简介</h2><p><a href="http://moveit.ros.org" target="_blank" rel="noopener">MoveIt官方教程</a></p>
<h3 id="MoveIt-三大核心功能"><a href="#MoveIt-三大核心功能" class="headerlink" title="MoveIt! 三大核心功能"></a>MoveIt! 三大核心功能</h3><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201126161937.png" alt="image-20201126161937539" style="zoom:80%;" />

<ul>
<li>运动学：KDL、Trac-IK、IKFast ……</li>
<li>路径规划：OMPL、CHOMP、SBPL ……</li>
<li>碰撞检测：FCL、PCD ……</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201126162124.png" alt="image-20201126162124713"></p>
<h3 id="MoveIt-核心节点-——-move-group"><a href="#MoveIt-核心节点-——-move-group" class="headerlink" title="MoveIt! 核心节点 —— move_group"></a>MoveIt! 核心节点 —— move_group</h3><p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201126162506.png" alt="image-20201126162506043"></p>
<ul>
<li>用户接口（User Interface）<ul>
<li>C++：使用move_group_interface包提供的API</li>
<li>Python：使用moveit_commander包提供的API</li>
<li>GUI：使用MoveIt！的rviz插件</li>
</ul>
</li>
<li>ROS参数服务器<ul>
<li>URDF：robot_description参数，获取机器人URDF模型的描述信息</li>
<li>SRDF：robot_description_semantic参数，获取机器人模型的配置信息</li>
<li>config：机器人的其他配置信息，例如关节限位、运动学插件、运动规插件等</li>
</ul>
</li>
<li>机器人<ul>
<li>Topic和Action通信</li>
</ul>
</li>
</ul>
<h3 id="使用MoveIt！"><a href="#使用MoveIt！" class="headerlink" title="使用MoveIt！"></a>使用MoveIt！</h3><ul>
<li><p>组装：创建机器人URDF模型</p>
</li>
<li><p>配置：使用MoveIt！Setup Assistant工具生成配置文件</p>
</li>
<li><p>驱动：添加机器人控制器插件（controller）</p>
</li>
<li><p>控制：MoveIt！控制机器人运动（算法仿真、物理仿真）</p>
</li>
</ul>
<br>

<br>

<h2 id="3-2-MoveIt！可视化配置"><a href="#3-2-MoveIt！可视化配置" class="headerlink" title="3.2 MoveIt！可视化配置"></a>3.2 MoveIt！可视化配置</h2><br>

<h3 id="MoveIt！安装命令："><a href="#MoveIt！安装命令：" class="headerlink" title="MoveIt！安装命令："></a>MoveIt！安装命令：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install ros-kinetic-moveit</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="moveit-setup-assistant"><a href="#moveit-setup-assistant" class="headerlink" title="moveit_setup_assistant"></a>moveit_setup_assistant</h3><h4 id="（1）启动Setup-Assistant"><a href="#（1）启动Setup-Assistant" class="headerlink" title="（1）启动Setup Assistant"></a>（1）启动Setup Assistant</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rosrun moveit_setup_assistant moveit_setup_assistant</span></span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127134502.png" alt="image-20201127134455554" style="zoom:80%;" />

<h4 id="（2）Start"><a href="#（2）Start" class="headerlink" title="（2）Start"></a>（2）Start</h4><ul>
<li>Create New MoveIt Configuration Package 创建新的功能包</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127134902.png" alt="image-20201127134902864" style="zoom:80%;" />

<ul>
<li>点击Browse选择xacro或urdf文件后，点击Load Files，可以在右方加载出机械臂模型。</li>
</ul>
<h4 id="（3）-Self-Collisions-自碰撞检测"><a href="#（3）-Self-Collisions-自碰撞检测" class="headerlink" title="（3） Self-Collisions 自碰撞检测"></a>（3） Self-Collisions 自碰撞检测</h4><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127145058.png" alt="image-20201127145058316" style="zoom:80%;" />

<ul>
<li>检测两个link在运动中是否会发生碰撞，点击Generate Collision Martrix生成碰撞矩阵，采样点选择默认的10000即可（官方推荐）</li>
</ul>
<h4 id="（4）Virtual-Joints-虚拟关节"><a href="#（4）Virtual-Joints-虚拟关节" class="headerlink" title="（4）Virtual Joints 虚拟关节"></a>（4）Virtual Joints 虚拟关节</h4><ul>
<li>虚拟关节主要用来描述机器人在world坐标系下的位置。如果机器人是移动的，则虚拟关节可以与移动基座关联，但这里设计的机械臂是固定不动的，所以无需设置虚拟关节。</li>
</ul>
<h4 id="（5）Planning-Groups-创建规划组"><a href="#（5）Planning-Groups-创建规划组" class="headerlink" title="（5）Planning Groups 创建规划组"></a>（5）Planning Groups 创建规划组</h4><ul>
<li>将机器人的多个组成部分（link，joint）集成到一个组中，运动规划器会针对一组link或joint完成规划任务。配置过程中，还可以选择运动学解析器。</li>
<li>点击Add Group<ul>
<li>Group Name，运动组命名。</li>
<li>Kinematic Solver，运动学求解器。负责求解正向运动学(Forward Kinematics)和逆运动学(IK)的。 一般选用KDL， The Kinematics and Dynamics Library。这是一个运动学与动力学的库，可以很好的解决6自由度以上的单链机械结构的正逆运动学问题。</li>
<li>Kin. Search Resolution：关节空间的采样密度。</li>
<li>Kin. Search Timeout(sec)：运动学求解时间。</li>
<li>Kin.Solver Attempts：求解失败尝试次数，一般来说以上三项使用默认值即可。</li>
<li>OMPL Planning：运动规划算法，选用RRT(Rapidly-exploring Random Trees)，这是一种基于采样的运动规划算法。</li>
</ul>
</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127153824.png" alt="image-20201127153824322" style="zoom:80%;" />

<ul>
<li>点击 Add Kin. Chian ，添加运动学求解链。<ul>
<li>选择 base_link 座位Base Link</li>
<li>选择 tool0 座位 Tip Link</li>
<li>Save</li>
</ul>
</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127155711.png" alt="image-20201127155711331" style="zoom:80%;" />

<h4 id="（6）Robot-Poses-机器人位姿"><a href="#（6）Robot-Poses-机器人位姿" class="headerlink" title="（6）Robot Poses 机器人位姿"></a>（6）Robot Poses 机器人位姿</h4><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127162348.png" alt="image-20201127162348386" style="zoom:80%;" />

<ul>
<li>设置一些自定义的位姿，比如机器人的初始位姿、指定位姿。点击Add Pose添加。</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127162554.png" alt="image-20201127162554450" style="zoom:80%;" />

<ul>
<li>设置home位姿，便于在仿真环境中让机械臂恢复到初始home位姿。设置完成点击Save即可。</li>
</ul>
<h4 id="（7）End-Effectors-配置终端夹爪"><a href="#（7）End-Effectors-配置终端夹爪" class="headerlink" title="（7）End Effectors 配置终端夹爪"></a>（7）End Effectors 配置终端夹爪</h4><ul>
<li>点击 Add End Effector</li>
</ul>
<h4 id="（8）Passive-Joints-消极关节"><a href="#（8）Passive-Joints-消极关节" class="headerlink" title="（8）Passive Joints 消极关节"></a>（8）Passive Joints 消极关节</h4><p>机器人上的某些关节可能在规划、控制过程中使用不到，可以先声明出来。</p>
<h4 id="（9）ROS-Control"><a href="#（9）ROS-Control" class="headerlink" title="（9）ROS Control"></a>（9）ROS Control</h4><p>给机器人各个关节设置Controller，每个关节如何通过Controller完成闭环控制，可以通过文件配置，此处略过</p>
<h4 id="（10）Simulate"><a href="#（10）Simulate" class="headerlink" title="（10）Simulate"></a>（10）Simulate</h4><p>后续手动添加，此处略过</p>
<h4 id="（11）3D-Perception-3D视觉"><a href="#（11）3D-Perception-3D视觉" class="headerlink" title="（11）3D Perception 3D视觉"></a>（11）3D Perception 3D视觉</h4><h4 id="（12）Author-Information-作者信息"><a href="#（12）Author-Information-作者信息" class="headerlink" title="（12）Author Information 作者信息"></a>（12）Author Information 作者信息</h4><h4 id="（13）Configuration-Files-配置文件"><a href="#（13）Configuration-Files-配置文件" class="headerlink" title="（13）Configuration Files 配置文件"></a>（13）Configuration Files 配置文件</h4><ul>
<li><p>自动生成配置功能包中的所有文件，点击Browser选择功能包目录保存</p>
</li>
<li><p>命名格式：机器人名字_moveit_config</p>
</li>
<li><p>点击Generate Package，OK。</p>
</li>
<li><p>Exit Setup Assistant</p>
</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127172150.png" alt="image-20201127172150596"></p>
<h4 id="（14）查看生成的配置文件"><a href="#（14）查看生成的配置文件" class="headerlink" title="（14）查看生成的配置文件"></a>（14）查看生成的配置文件</h4><p>在*_moveit_config 文件夹下会生成如图文件</p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127202636.png" alt="image-20201127202636342" style="zoom: 80%;" />

<p><strong>config文件夹下：</strong></p>
<ul>
<li>kinematics.yaml 保存了运动学求解器的相关设置，如 kdl</li>
<li>joint_limits.yaml 保存了每个关节的限位，此文件后续会经常修改，此文件的修改会覆盖urdf中的配置，所以以此文件的配置为准</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127202730.png" alt="image-20201127202730954" style="zoom:80%;" />

<p><strong>launch文件夹下：</strong></p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127203047.png" alt="image-20201127203047647" style="zoom: 67%;" />

<p>可以运行其中的demo.launch验证是否配置成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> roslaunch probot_anno_moveit_config demo.launch</span></span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127203500.png" alt="image-20201127203500838" style="zoom:80%;" />

<p>添加RobotModel插件</p>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201127203556.png" alt="image-20201127203556602" style="zoom:80%;" />
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MoveIt/" rel="tag">MoveIt!</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ROS/" rel="tag">ROS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ROS MoviIt!教程 - 2.ROS机器人建模" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%202.ROS%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%BB%BA%E6%A8%A1/"
    >ROS MoviIt!学习 - 2.ROS机器人建模</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%202.ROS%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%BB%BA%E6%A8%A1/" class="article-date">
  <time datetime="2021-05-27T09:29:16.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="二、ROS机器人建模"><a href="#二、ROS机器人建模" class="headerlink" title="二、ROS机器人建模"></a>二、ROS机器人建模</h1><h2 id="2-1-URDF建模原理"><a href="#2-1-URDF建模原理" class="headerlink" title="2.1 URDF建模原理"></a>2.1 URDF建模原理</h2><ul>
<li>URDF：一种使用XML格式描述的机器人模型文件<ul>
<li>Links：坐标系与几何关系</li>
<li>Joints：Links之间的连接关系</li>
</ul>
</li>
<li>类似于D-H参数</li>
<li>可以描述完整的工作空间，不局限于机器人</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201123091535.png" alt="image-20201123091535476" style="zoom: 80%;" />

<h3 id="lt-link-gt-标签"><a href="#lt-link-gt-标签" class="headerlink" title="&lt;link&gt;标签"></a>&lt;link&gt;标签</h3><ul>
<li>描述机器人某个刚体部分的外观和物理属性</li>
<li>描述连杆尺寸（size）、颜色（color）、形状（shape）、惯性矩阵（inertial matrix），碰撞参数（collision properties）等</li>
<li>每个Link会成为一个坐标系, xyz单位是米, rpy单位是弧度</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span> = <span class="string">"link_4"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"link_4.stl"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">length</span>=<span class="string">"0.5"</span> <span class="attr">radius</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 -0.05"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201123092304.png" alt="image-20201123092304901" style="zoom:80%;" />

<h3 id="lt-joint-gt-标签"><a href="#lt-joint-gt-标签" class="headerlink" title="&lt;joint&gt;标签"></a>&lt;joint&gt;标签</h3><ul>
<li>描述两个link之间的关系，分六种类型</li>
</ul>
<table>
<thead>
<tr>
<th>关节类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td>continuous</td>
<td align="left">旋转关节，可以围绕单轴无线旋转，常用。</td>
</tr>
<tr>
<td>revolute</td>
<td align="left">旋转关节，类似于continuous，但是又旋转的角度极限，常用。</td>
</tr>
<tr>
<td>prismatic</td>
<td align="left">滑动关机，沿某一轴线移动的关节，带有位置极限，常用。</td>
</tr>
<tr>
<td>planar</td>
<td align="left">平面关节，允许在平面正交方向上平移或者旋转，不常用。</td>
</tr>
<tr>
<td>floating</td>
<td align="left">浮动关节，允许进行平移、旋转运动，不常用。</td>
</tr>
<tr>
<td>fixed</td>
<td align="left">固定关节，不允许运动的特殊关节，比如把相机固定在机器人上。</td>
</tr>
</tbody></table>
<ul>
<li>包括关节运动的位置和速度限制</li>
<li>描述机器人关节的运动学和动力学属性</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_2"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"link_1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"link_2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0.2 0.2 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"-3.14"</span> <span class="attr">upper</span>=<span class="string">"3.14"</span> <span class="attr">velocity</span>=<span class="string">"1.0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- origin表示两个坐标的位置关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- axis表示围绕哪个轴做旋转，0 0 1 表示选中z轴 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- velocity的单位是 弧度每秒 或 米每秒 --&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201123093706.png" alt="image-20201123093706498" style="zoom:80%;" />

<h3 id="lt-robot-gt-标签"><a href="#lt-robot-gt-标签" class="headerlink" title="&lt;robot&gt;标签"></a>&lt;robot&gt;标签</h3><ul>
<li><p>完整机器人模型的最顶层标签</p>
</li>
<li><p>&lt;link&gt; 和 &lt;joint&gt;标签都必须包含在&lt;robot&gt;标签内</p>
</li>
<li><p>一个完整的机器人模型，由一系列&lt;link&gt; 和 &lt;joint&gt;组成</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"&lt;name of the robot&gt;"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span>&gt;</span>......<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span>&gt;</span>......<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span>&gt;</span>......<span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span>&gt;</span>......<span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="URDF-建模存在一些问题："><a href="#URDF-建模存在一些问题：" class="headerlink" title="URDF 建模存在一些问题："></a>URDF 建模存在一些问题：</h3><ul>
<li><p>模型冗长，重复内容多</p>
</li>
<li><p>参数修改麻烦，不利于二次开发</p>
</li>
<li><p>没用参数计算的功能</p>
<p>….</p>
</li>
</ul>
<h2 id="2-2-URDF模型的进化版本-——-xacro模型文件"><a href="#2-2-URDF模型的进化版本-——-xacro模型文件" class="headerlink" title="2.2 URDF模型的进化版本 —— xacro模型文件"></a>2.2 URDF模型的进化版本 —— xacro模型文件</h2><ul>
<li>精简模型代码</li>
<li>提供可编程接口</li>
</ul>
<h3 id="使用常量定义"><a href="#使用常量定义" class="headerlink" title="使用常量定义"></a>使用常量定义</h3><ul>
<li><p>常量定义 <code>&lt;xacro:property name=&quot;M_PI&quot; value=&quot;3.14159&quot;/&gt;</code></p>
</li>
<li><p>常量使用 <code>&lt;origin xyz=&quot;0 0 0&quot; rpy=&quot;${M_PI/2} 0 0&quot;/&gt;</code></p>
</li>
</ul>
<h3 id="数学计算"><a href="#数学计算" class="headerlink" title="数学计算"></a>数学计算</h3><p>两个轮子间的距离可以通过底盘的尺寸计算</p>
<p><code>origin xyz=&quot;0 ${(motor_length+wheel_length)/2} 0&quot; rpy=&quot;0 0 0&quot;/&gt;</code></p>
<h3 id="使用宏定义声明重复使用的代码模块"><a href="#使用宏定义声明重复使用的代码模块" class="headerlink" title="使用宏定义声明重复使用的代码模块"></a>使用宏定义声明重复使用的代码模块</h3><ul>
<li>宏定义</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">params</span>=<span class="string">"A B C"</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>宏调用</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span> <span class="attr">A</span>=<span class="string">"A_value"</span> <span class="attr">B</span>=<span class="string">"B_value"</span> <span class="attr">C</span>=<span class="string">"C_value"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p><code>&lt;xacro:include filename=&quot;$(find mbot_description)/urdf/xacro/mbot_base.xacro&quot;/&gt;</code></p>
<h2 id="2-3-机械臂URDF建模"><a href="#2-3-机械臂URDF建模" class="headerlink" title="2.3 机械臂URDF建模"></a>2.3 机械臂URDF建模</h2><h2 id="2-4-三维模型导出URDF"><a href="#2-4-三维模型导出URDF" class="headerlink" title="2.4 三维模型导出URDF"></a>2.4 三维模型导出URDF</h2>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MoveIt/" rel="tag">MoveIt!</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ROS/" rel="tag">ROS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-ROS MoviIt!教程 - 1.ROS概览" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%201.ROS%E6%A6%82%E8%A7%88/"
    >ROS MoviIt!学习 - 1.ROS概览</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/ROS%20MoviIt!%E6%95%99%E7%A8%8B%20-%201.ROS%E6%A6%82%E8%A7%88/" class="article-date">
  <time datetime="2021-05-27T09:29:15.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="一、ROS-概览"><a href="#一、ROS-概览" class="headerlink" title="一、ROS 概览"></a>一、ROS 概览</h1><h2 id="1-1-ROS是什么？"><a href="#1-1-ROS是什么？" class="headerlink" title="1. 1 ROS是什么？"></a>1. 1 ROS是什么？</h2><p>ROS = 通信机制+开发工具+应用功能+生态系统</p>
<h2 id="1-2-ROS的通信机制"><a href="#1-2-ROS的通信机制" class="headerlink" title="1.2 ROS的通信机制"></a>1.2 ROS的通信机制</h2><h3 id="（1）核心概念"><a href="#（1）核心概念" class="headerlink" title="（1）核心概念"></a>（1）核心概念</h3><ul>
<li>节点 Node —— 软件模块</li>
<li>节点管理器 ROS Master —— 控制中心，提供参数管理</li>
<li>话题 Topic —— 异步通讯机制，传输消息 （Message）</li>
<li>服务 Service —— 同步通信机制，传输请求 / 应答数据</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122150638.png" alt=""></p>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122151047.png" alt=""></p>
<h3 id="（2）话题通信模型"><a href="#（2）话题通信模型" class="headerlink" title="（2）话题通信模型"></a>（2）话题通信模型</h3><ul>
<li>Talker注册</li>
<li>Listener注册</li>
<li>ROS Master进行信息匹配</li>
<li>Listener发送连接请求</li>
<li>Talker确认连接请求</li>
<li>建立网络连接</li>
<li>Talker向Listener发布数据</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122152256.png" alt="image-20201122152256520"></p>
<h3 id="（3）服务通信模型"><a href="#（3）服务通信模型" class="headerlink" title="（3）服务通信模型"></a>（3）服务通信模型</h3><ul>
<li>Talker注册</li>
<li>Listener注册</li>
<li>ROS Master进行信息匹配</li>
<li>建立网络连接</li>
<li>Talker向Listener发布服务应答数据</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122152530.png" alt="image-20201122152530468"></p>
<h3 id="4-动作"><a href="#4-动作" class="headerlink" title="(4) 动作"></a>(4) 动作</h3><h4 id="什么是动作-Action？"><a href="#什么是动作-Action？" class="headerlink" title="什么是动作 Action？"></a>什么是动作 Action？</h4><ul>
<li>一种问答通信机制</li>
<li>带有连续反馈</li>
<li>可以在任务过程中止运行</li>
<li>基于ROS的消息机制实现</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122153222.png" alt="image-20201122153222680"></p>
<h4 id="Action的接口"><a href="#Action的接口" class="headerlink" title="Action的接口"></a>Action的接口</h4><ul>
<li>goal：发布任务目标</li>
<li>cancel：请求取消任务</li>
<li>status：通知客户端当前的状态</li>
<li>feedback：周期反馈任务运行的监控数据</li>
<li>result：向客户端发送任务的执行结果，只发布一次。</li>
</ul>
<img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122153233.png" alt="image-20201122153233168" style="zoom: 50%;" />

<p><br><br></p>
<h2 id="1-3-ROS的开发工具"><a href="#1-3-ROS的开发工具" class="headerlink" title="1.3 ROS的开发工具"></a>1.3 ROS的开发工具</h2><h3 id="（1）命令行-amp-编译器"><a href="#（1）命令行-amp-编译器" class="headerlink" title="（1）命令行&amp;编译器"></a>（1）命令行&amp;编译器</h3><p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/20201122153704.png" alt="image-20201122153704540"></p>
<h3 id="（2）Launch启动文件"><a href="#（2）Launch启动文件" class="headerlink" title="（2）Launch启动文件"></a>（2）Launch启动文件</h3><p>通过XML文件实现多节点的配置和启动（可自动启动ROS Master）</p>
<h3 id="（3）TF坐标变换库"><a href="#（3）TF坐标变换库" class="headerlink" title="（3）TF坐标变换库"></a>（3）TF坐标变换库</h3><h3 id="（4）Qt工具箱"><a href="#（4）Qt工具箱" class="headerlink" title="（4）Qt工具箱"></a>（4）Qt工具箱</h3><h3 id="（5）Rviz"><a href="#（5）Rviz" class="headerlink" title="（5）Rviz"></a>（5）Rviz</h3><p>三维可视化工具，可以很好的兼容基于ROS软件框架的机器人平台</p>
<h3 id="（6）Gazebo"><a href="#（6）Gazebo" class="headerlink" title="（6）Gazebo"></a>（6）Gazebo</h3><p>Gazebo是一款功能强大的三维物理仿真平台</p>
<h2 id="1-4-ROS的应用功能"><a href="#1-4-ROS的应用功能" class="headerlink" title="1.4 ROS的应用功能"></a>1.4 ROS的应用功能</h2><ul>
<li>导航框架</li>
<li>SLAM</li>
<li>MoveIt！</li>
<li>SMACH任务级状态机</li>
</ul>
<h2 id="1-5-ROS-生态系统"><a href="#1-5-ROS-生态系统" class="headerlink" title="1.5 ROS 生态系统"></a>1.5 ROS 生态系统</h2><ul>
<li>发行版 Distribution</li>
<li>软件源 Repository</li>
<li>ROS wiki</li>
<li>邮件列表</li>
<li>ROS Answers</li>
<li>博客 <a href="http://www.ros.org/news" target="_blank" rel="noopener">www.ros.org/news</a></li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MoveIt/" rel="tag">MoveIt!</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ROS/" rel="tag">ROS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Ubuntu18.04 Cuda10.1 Cudnn8.0 Anaconda4.8 PyCharm2020环境配置" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/Ubuntu18.04%20Cuda10.1%20Cudnn8.0%20Anaconda4.8%20PyCharm2020%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"
    >Ubuntu18.04 Cuda10.1 Cudnn8.0 Anaconda4.8 PyCharm2020环境配置</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/Ubuntu18.04%20Cuda10.1%20Cudnn8.0%20Anaconda4.8%20PyCharm2020%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2021-05-27T06:37:20.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">深度学习环境配置</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="Ubuntu-Pytorch-环境配置"><a href="#Ubuntu-Pytorch-环境配置" class="headerlink" title="Ubuntu Pytorch 环境配置"></a>Ubuntu Pytorch 环境配置</h1><h2 id="1-显卡驱动安装"><a href="#1-显卡驱动安装" class="headerlink" title="1 - 显卡驱动安装"></a>1 - 显卡驱动安装</h2><p><code>nvidia-smi</code> 查看显卡驱动是否安装</p>
<p>RTX TITAN 驱动：<a href="https://www.nvidia.cn/geforce/drivers/" target="_blank" rel="noopener">https://www.nvidia.cn/geforce/drivers/</a></p>
<p>安装命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">cd 到驱动路径</span><br><span class="line">bash  NVIDIA-Linux-x86_64-450.66.run</span><br></pre></td></tr></table></figure>



<h2 id="2-Cuda-amp-Cudann-安装"><a href="#2-Cuda-amp-Cudann-安装" class="headerlink" title="2 - Cuda  &amp; Cudann 安装"></a>2 - Cuda  &amp; Cudann 安装</h2><h3 id="2-1-安装cuda10-1"><a href="#2-1-安装cuda10-1" class="headerlink" title="2.1 - 安装cuda10.1"></a>2.1 - 安装cuda10.1</h3><p>cuda 10.1 <a href="https://developer.nvidia.com/cuda-10.1-download-archive-base?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1804&amp;target_type=runfilelocal" target="_blank" rel="noopener">https://developer.nvidia.com/cuda-10.1-download-archive-base?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1804&amp;target_type=runfilelocal</a></p>
<p>安装指令：</p>
<p>在文件目录终端输入</p>
<p><code>sudo sh cuda_10.1.105_418.39_linux.run</code></p>
<p>如果之前安装了驱动，将driver选项取消</p>
<h3 id="2-2-配置环境变量"><a href="#2-2-配置环境变量" class="headerlink" title="2.2 - 配置环境变量"></a>2.2 - 配置环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">i 进入编辑模式</span><br><span class="line"># 文件末尾添加</span><br><span class="line">export PATH&#x3D;&quot;&#x2F;usr&#x2F;local&#x2F;cuda-10.1&#x2F;bin:$PATH&quot;</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&quot;&#x2F;usr&#x2F;lcoal&#x2F;cuda-10.1&#x2F;lib64:$LD_LIBRARY_PATH&quot;</span><br><span class="line">Esc :wq</span><br><span class="line">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<p>验证是否配置成功, 如果出现Result = PASS则表示安装成功通过!!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/cuda-10.1/samples/1_Utilities/deviceQuery</span><br><span class="line">sudo make</span><br><span class="line">./deviceQuery</span><br></pre></td></tr></table></figure>

<h3 id="2-3-安装Cudnn"><a href="#2-3-安装Cudnn" class="headerlink" title="2.3 - 安装Cudnn"></a>2.3 - 安装Cudnn</h3><p><a href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener">https://developer.nvidia.com/rdp/cudnn-download</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf cudnn-10.1-linux-x64-v8.0.3.33.tgz</span><br><span class="line"></span><br><span class="line">sudo cp cuda/include/cudnn.h /usr/local/cuda-10.1/include</span><br><span class="line">sudo cp cuda/lib64/libcudnn* /usr/local/cuda-10.1/lib64</span><br><span class="line">sudo chmod a+r /usr/local/cuda-10.1/include/cudnn.h /usr/local/cuda-10.1/lib64/libcudnn*</span><br><span class="line"></span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/cuda-10.1/lib</span><br><span class="line">export PATH=$PATH:/usr/local/cuda-10.1/bin</span><br></pre></td></tr></table></figure>



<h2 id="3-Anaconda-miniconda-安装"><a href="#3-Anaconda-miniconda-安装" class="headerlink" title="3 - Anaconda (miniconda) 安装"></a>3 - Anaconda (miniconda) 安装</h2><p>官方文档 <a href="https://conda.io/projects/conda/en/latest/" target="_blank" rel="noopener">https://conda.io/projects/conda/en/latest/</a></p>
<p><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=S&amp;O=A" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=S&amp;O=A</a></p>
<p><code>sh Miniconda3-py37_4.8.2-Linux-x86_64.sh</code></p>
<p>写入环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~&#x2F;.bashrc</span><br><span class="line">export PATH&#x3D;~&#x2F;miniconda3&#x2F;bin:$PATH</span><br><span class="line">source ~&#x2F;.bashrc</span><br><span class="line">conda</span><br></pre></td></tr></table></figure>

<ul>
<li><code>conda list</code>  包列表</li>
<li><code>conda env list</code> 虚拟环境列表</li>
</ul>
<h4 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h4><p>一键使用TUNA源脚本 （ oh-my-tuna）</p>
<p><a href="https://github.com/tuna/oh-my-tuna" target="_blank" rel="noopener">https://github.com/tuna/oh-my-tuna</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;tuna.moe&#x2F;oh-my-tuna&#x2F;oh-my-tuna.py</span><br><span class="line">sudo python3 oh-my-tuna.py --global   # 全局</span><br><span class="line">python3 oh-my-tuna.py</span><br></pre></td></tr></table></figure>

<h2 id="4-安装Pycharm"><a href="#4-安装Pycharm" class="headerlink" title="4 - 安装Pycharm"></a>4 - 安装Pycharm</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf pycharm-professional-2020.2.1.tar.gz</span><br><span class="line">cd pycharm-2020.2.1/bin/</span><br><span class="line">sh ./pycharm.sh</span><br></pre></td></tr></table></figure>

<p>在输入激活码的界面退出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;etc</span><br><span class="line">sudo chmod 777 hosts</span><br><span class="line">sudo gedit hosts</span><br><span class="line"># 最后一行添加</span><br><span class="line">0.0.0.0 account.jetbrains.com</span><br></pre></td></tr></table></figure>

<p>重新启动pycharm-2020.2.1/bin/ 终端下 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh .&#x2F;pycharm.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入激活码 网上搜索</span><br></pre></td></tr></table></figure>

<p>创建启动图标</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /usr/share/applications/pycharm.desktop</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]Type&#x3D;ApplicationName&#x3D;PycharmGenericName&#x3D;Pycharm3Comment&#x3D;Pycharm3:The Python IDEExec&#x3D;sh &#x2F;home&#x2F;zhuozhu&#x2F;桌面&#x2F;软件&#x2F;深度学习&#x2F;pycharm-2020.2.1&#x2F;bin&#x2F;pycharm.shIcon&#x3D;&#x2F;home&#x2F;zhuozhu&#x2F;桌面&#x2F;软件&#x2F;深度学习&#x2F;pycharm-2020.2.1&#x2F;bin&#x2F;pycharm.pngTerminal&#x3D;pycharm</span><br></pre></td></tr></table></figure>

<h2 id="5-安装Pytorch"><a href="#5-安装Pytorch" class="headerlink" title="5 - 安装Pytorch"></a>5 - 安装Pytorch</h2><p><a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener">https://pytorch.org/get-started/locally/</a></p>
<p><code>conda install pytorch torchvision cudatoolkit=10.1</code></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cuda/" rel="tag">Cuda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" rel="tag">环境配置</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Jupyter插件设置和主题美化" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/27/Jupyter%E6%8F%92%E4%BB%B6%E8%AE%BE%E7%BD%AE%E5%92%8C%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/"
    >Jupyter安装扩展和主题美化</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/27/Jupyter%E6%8F%92%E4%BB%B6%E8%AE%BE%E7%BD%AE%E5%92%8C%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/" class="article-date">
  <time datetime="2021-05-27T06:09:20.000Z" itemprop="datePublished">2021-05-27</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">深度学习环境配置</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h2 id="1-安装扩展"><a href="#1-安装扩展" class="headerlink" title="1 - 安装扩展"></a>1 - 安装扩展</h2><ul>
<li>安装nbextensions<ul>
<li><code>pip install jupyter_contrib_nbextensions</code></li>
<li><code>jupyter contrib nbextension install --user</code></li>
</ul>
</li>
<li>安装nbextensions_configurator<ul>
<li><code>pip install jupyter_nbextensions_configurator</code></li>
<li><code>jupyter nbextensions_configurator enable --user</code></li>
</ul>
</li>
<li>问题 1<ul>
<li>关于<code>ImportError: cannot import name &#39;secure_write&#39;</code>问题</li>
<li>输入：<code>pip install --upgrade jupyter_client</code></li>
</ul>
</li>
</ul>
<h2 id="2-主题美化"><a href="#2-主题美化" class="headerlink" title="2 - 主题美化"></a>2 - 主题美化</h2><ul>
<li><p>安装主题</p>
<p><code>pip install jupyterthemes -i http://mirrors.aliyun.com/pypi/simple/  --trusted-host mirrors.aliyun.com</code></p>
<p><code>pip install terminado --ignore-installed</code></p>
</li>
<li><p>查看主题列表</p>
<p><code>jt -l</code></p>
</li>
<li><p>设置主题,字体,字体大小等</p>
<p><code>jt --lineh 140  -tf ptmono -t onedork -ofs 13 -nfs 14 -tfs 14 -fs 16 -T -N -dfs 10 -cellw 90%</code></p>
<ul>
<li>-f(字体)  -fs(字体大小) -cellw(占屏比或宽度)  -ofs(输出段的字号)  -T(显示工具栏)  -N(显示自己主机名)</li>
</ul>
</li>
</ul>
<h2 id="3-代码补全"><a href="#3-代码补全" class="headerlink" title="3 - 代码补全"></a>3 - 代码补全</h2><ul>
<li>选中Hinterland即可</li>
</ul>
<p><img src="https://gitee.com/song-zhuozhu/my_image/raw/master/img/image-20210603095509104.png" alt="image-20210603095509104"></p>
<ul>
<li>其他功能也可以自行选取，如markdown，latex支持，代码格式化等。</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jupyter/" rel="tag">Jupyter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" rel="tag">环境配置</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-CNote4" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/22/CNote4/"
    >C基础 - 时间操作、编译预处理、系统错误</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/22/CNote4/" class="article-date">
  <time datetime="2021-05-22T09:29:19.000Z" itemprop="datePublished">2021-05-22</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="C基础-4"><a href="#C基础-4" class="headerlink" title="C基础 4"></a>C基础 4</h1><h2 id="1-C语言时间操作"><a href="#1-C语言时间操作" class="headerlink" title="1 - C语言时间操作"></a>1 - C语言时间操作</h2><h3 id="time-t别名"><a href="#time-t别名" class="headerlink" title="time_t别名"></a>time_t别名</h3><p>在C语言中，用time_t来表示时间数据类型，它是一个long（长整数）类型的别名，在time.h文件中定义，表示一个日历时间，是从1970年1月1日0时0分0秒到现在的秒数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">time_t</span>;</span><br></pre></td></tr></table></figure>

<h4 id="两种调用time库函数方法："><a href="#两种调用time库函数方法：" class="headerlink" title="两种调用time库函数方法："></a>两种调用time库函数方法：</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> tnow1, tnow2;</span><br><span class="line">tnow1 = time(<span class="number">0</span>);</span><br><span class="line">time(&amp;tnow2);</span><br></pre></td></tr></table></figure>

<h4 id="tm结构体"><a href="#tm结构体" class="headerlink" title="tm结构体"></a>tm结构体</h4><p>time_t只是一个长整型，不符合我们的使用习惯，需要转换成可以方便表示时间的结构体，即tm结构体，tm结构体在time.h中声明，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">int</span> tm_sec;     <span class="comment">// 秒：取值区间为[0,59]</span></span><br><span class="line">  <span class="keyword">int</span> tm_min;     <span class="comment">// 分：取值区间为[0,59]</span></span><br><span class="line">  <span class="keyword">int</span> tm_hour;    <span class="comment">// 时：取值区间为[0,23]</span></span><br><span class="line">  <span class="keyword">int</span> tm_mday;    <span class="comment">// 日期：一个月中的日期：取值区间为[1,31]</span></span><br><span class="line">  <span class="keyword">int</span> tm_mon;     <span class="comment">// 月份：（从一月开始，0代表一月），取值区间为[0,11]</span></span><br><span class="line">  <span class="keyword">int</span> tm_year;    <span class="comment">// 年份：其值等于实际年份减去1900</span></span><br><span class="line">  <span class="keyword">int</span> tm_wday;    <span class="comment">// 星期：取值区间为[0,6]，其中0代表星期天，1代表星期一，以此类推</span></span><br><span class="line">  <span class="keyword">int</span> tm_yday;    <span class="comment">// 从每年的1月1日开始的天数：取值区间为[0,365]，其中0代表1月1日，1代表1月2日，以此类推</span></span><br><span class="line">  <span class="keyword">int</span> tm_isdst;   <span class="comment">// 夏令时标识符，该字段意义不大，我们不用夏令时。</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="locatime函数"><a href="#locatime函数" class="headerlink" title="locatime函数"></a>locatime函数</h4><p>localtime函数用于把time_t表示的时间转换为struct tm结构体表示的时间，函数返回struct tm结构体的地址。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct tm * <span class="title">localtime</span><span class="params">(<span class="keyword">const</span> <span class="keyword">time_t</span> *)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="mktime函数"><a href="#mktime函数" class="headerlink" title="mktime函数"></a>mktime函数</h4><p>mktime函数的功能与localtime函数相反。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">time_t</span> <span class="title">mktime</span><span class="params">(struct tm *tm)</span></span>;</span><br></pre></td></tr></table></figure>



<h2 id="2-编译预处理"><a href="#2-编译预处理" class="headerlink" title="2 - 编译预处理"></a>2 - 编译预处理</h2><p>C语言由源代码生成可执行程序的过程如下：</p>
<p><strong>C源程序－&gt;编译预处理－&gt;编译－&gt;优化程序－&gt;汇编程序－&gt;链接程序－&gt;可执行文件</strong></p>
<h3 id="条件编译："><a href="#条件编译：" class="headerlink" title="条件编译："></a>条件编译：</h3><h4 id="ifdef"><a href="#ifdef" class="headerlink" title="#ifdef :"></a>#ifdef :</h4><p>​    如果#ifdef后面的标识符已被定义过，则对“程序段1”进行编译；如果没有定义标识符，则编译“程序段2”。一般不使用#else及后面的“程序2”</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> 标识符</span></span><br><span class="line">  程序段 <span class="number">1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  程序段 <span class="number">2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<h4 id="ifndef"><a href="#ifndef" class="headerlink" title="#ifndef"></a>#ifndef</h4><p>​    如果未定义标识符，则编译“程序段1”；否则编译“程序段2”</p>
<p>在实际开发中，用#ifndef来防止头文件被重复包含。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifndef 标识符</span><br><span class="line">  程序段 1</span><br><span class="line">#else</span><br><span class="line">  程序段 2 </span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>



<h4 id="undef"><a href="#undef" class="headerlink" title="#undef"></a>#undef</h4><p>#undef取消已定义的标识符。</p>
<h2 id="3-系统错误"><a href="#3-系统错误" class="headerlink" title="3 - 系统错误"></a>3 - 系统错误</h2><h3 id="strerror函数"><a href="#strerror函数" class="headerlink" title="strerror函数"></a>strerror函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">strerror</span><span class="params">(<span class="keyword">int</span> errno)</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>函数说明：strerror()用来依参数errno 的错误代码来查询其错误原因的描述字符串，然后将该字符串指针返回。</p>
</li>
<li><p>返回值：返回描述错误原因的字符串地址。</p>
</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">C语言基础知识</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">C语言学习笔记</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Cpp-Primer-5th-Notes-Ch1 开始" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/22/Cpp-Primer-5th-Notes-Ch1%20%E5%BC%80%E5%A7%8B/"
    >《Cpp-Primer-5th》Notes-Ch1 开始</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/22/Cpp-Primer-5th-Notes-Ch1%20%E5%BC%80%E5%A7%8B/" class="article-date">
  <time datetime="2021-05-22T09:29:19.000Z" itemprop="datePublished">2021-05-22</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/C/">C++</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="第一章-开始"><a href="#第一章-开始" class="headerlink" title="第一章 开始"></a>第一章 开始</h1><h2 id="1-1-编写一个简单的C-程序"><a href="#1-1-编写一个简单的C-程序" class="headerlink" title="1.1 编写一个简单的C++程序"></a>1.1 编写一个简单的C++程序</h2><ul>
<li>常见的C++程序后缀名 .cc .cxx .cpp .cp .c</li>
<li>编译命令 $ CC prog.cc 会产生一个可执行文件<ul>
<li>Windows系统命名为 prog.exe</li>
<li>UNIX系统命名为 a.out</li>
</ul>
</li>
<li>运行GNU编译器的命令是g++：<ul>
<li>$ g++ -o prog prog.cc</li>
</ul>
</li>
<li>执行完一个程序后，可以通过echo命令获得其返回值。<ul>
<li>UNIX: $ echo $?</li>
<li>Windows: $ echo %ERRORLEVEL%</li>
</ul>
</li>
</ul>
<h2 id="1-2-初识输入输出"><a href="#1-2-初识输入输出" class="headerlink" title="1.2 初识输入输出"></a>1.2 初识输入输出</h2><ul>
<li><p>一个流就是一个字符序列，是从IO设备读出或写入IO设备的。术语“流”（stream）想表达的是，随着时间的推移，字符是顺序生成或消耗的。</p>
</li>
<li><p>标准库定义了4个IO对象：</p>
<ul>
<li>cin 标准输入</li>
<li>cout 标准输出</li>
<li>cerr 输出警告和错误消息</li>
<li>clog 输出程序运行时的一般性信息</li>
</ul>
</li>
<li><p>向流写入数据：输出运算符 (&lt;&lt;)</p>
<ul>
<li>将给定的值写到给定的ostream对象中。输出运算符的计算结果就是其左侧运算对象。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"hello world"</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure></li>
<li>&lt;&lt;运算符接收两个运算对象：<ul>
<li>左侧的运算对象必须是一个ostream对象</li>
<li>右侧的运算对象是要打印的值</li>
</ul>
</li>
<li>输出语句使用了两次 &lt;&lt; 运算符，因为此运算符返回其左侧的运算对象，因此第一个运算符的结果成为了第二个运算符的左侧运算对象，等价于：<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"hello world"</span>)&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>从流读取数据 输入运算符 (&gt;&gt;)</p>
<ul>
<li>输入运算符与输出运算符类似，接收一个istream作为其左侧运算对象，接收一个对象作为其右侧运算对象。从给定的istream读入数据，并存入给定对象中。</li>
</ul>
</li>
<li><p>endl 操作符</p>
<ul>
<li>写入endl的效果是结束当前行，并将与设备关联的缓冲区buffer中的内容刷到设备中。缓冲刷新可以保证到目前为止程序所产生的所有输出都真正写入输出流中，而不是仅停留在内存中等待写入流。</li>
<li>warning：程序员常在调试打印是时添加打印语句。这类语句应该保证”一直“刷新流。否则如果程序崩溃，输出可能还停留在缓冲区中，从而导致关于程序崩溃位置的错误推断。</li>
</ul>
</li>
<li><p>namespace 命名空间</p>
<ul>
<li>命名空间可以帮助我们避免不经意的名字定义冲突，以及使用库中相同名字导致的冲突。标准库定义的所有名字都在命名空间std中。</li>
</ul>
</li>
</ul>
<h2 id="1-3-注释简介"><a href="#1-3-注释简介" class="headerlink" title="1.3 注释简介"></a>1.3 注释简介</h2><ul>
<li>注释不能嵌套使用, /* — */ 中不能有 /* — */</li>
</ul>
<h2 id="1-4-控制流"><a href="#1-4-控制流" class="headerlink" title="1.4 控制流"></a>1.4 控制流</h2><ul>
<li><p>读取数量不定的输入数据</p>
<ul>
<li>使用一个istream对象，其效果是检测流的状态，如果流是有效的，ok。当遇到文件结束符（end-of-file）或遇到一个无效的输入时，istream对象的状态就会变为无效，处于无效状态的istream对象会使条件变为 假<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; value)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>常见的编译器可以检查出的错误</p>
<ul>
<li>语法错误（syntax error）：比如忘了写分号</li>
<li>类型错误（type error）</li>
<li>声明错误（declaration error）：比如标识符拼写错误</li>
</ul>
</li>
</ul>
<h2 id="1-5-类简介"><a href="#1-5-类简介" class="headerlink" title="1.5 类简介"></a>1.5 类简介</h2><ul>
<li>通常用.h作为头文件的后缀，但也有一些程序员习惯 .H  .hpp  .hxx，标准库头文件通常不带后缀。</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">C++基础知识</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">C++学习笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E3%80%8AC-Primer-Plus%E3%80%8B/" rel="tag">《C++ Primer Plus》</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Cpp-Primer-5th-Notes-Ch3 字符串、向量和数组" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/05/22/Cpp-Primer-5th-Notes-Ch3%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E5%90%91%E9%87%8F%E5%92%8C%E6%95%B0%E7%BB%84/"
    >《Cpp-Primer-5th》Notes-Ch3 字符串、向量和数组</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2021/05/22/Cpp-Primer-5th-Notes-Ch3%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E5%90%91%E9%87%8F%E5%92%8C%E6%95%B0%E7%BB%84/" class="article-date">
  <time datetime="2021-05-22T09:29:19.000Z" itemprop="datePublished">2021-05-22</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/C/">C++</a>
  </div>

      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="第三章-字符串、向量和数组"><a href="#第三章-字符串、向量和数组" class="headerlink" title="第三章 字符串、向量和数组"></a>第三章 字符串、向量和数组</h1><h2 id="3-1-命名空间的-using-声明"><a href="#3-1-命名空间的-using-声明" class="headerlink" title="3.1 命名空间的 using 声明"></a>3.1 命名空间的 using 声明</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用cin cout endl，用using声明</span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cin</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>; <span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>头文件不应该包含using声明</li>
</ul>
<h2 id="3-2-标准库类型string"><a href="#3-2-标准库类型string" class="headerlink" title="3.2 标准库类型string"></a>3.2 标准库类型string</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">string</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-1-定义和初始化-string-对象"><a href="#3-2-1-定义和初始化-string-对象" class="headerlink" title="3.2.1 定义和初始化 string 对象"></a>3.2.1 定义和初始化 string 对象</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化string对象的方式</span></span><br><span class="line"><span class="built_in">string</span> s1;          <span class="comment">// 默认初始化，s1是一个空串</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s2</span><span class="params">(s1)</span></span>;      <span class="comment">// s2是s1的副本</span></span><br><span class="line"><span class="built_in">string</span> s2 = s1;     <span class="comment">// 和上面等价</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s3</span><span class="params">(<span class="string">"value"</span>)</span></span>; <span class="comment">// s3是字面值“value”的副本，除了字面值最好的那个空字符</span></span><br><span class="line"><span class="built_in">string</span> s3 = <span class="string">"value"</span>;<span class="comment">// 和上面等价</span></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s4</span><span class="params">(n, <span class="string">'c'</span>)</span></span>;  <span class="comment">// 把s4初始化为由n个字符c组成的串</span></span><br></pre></td></tr></table></figure>
<p><strong>直接初始化和拷贝初始化</strong></p>
<ul>
<li>如果使用等号(=)初始化一个变量，实际上执行的是拷贝初始化。</li>
<li>不使用等号，即为直接初始化<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般要初始化多个值时用直接初始化，单个两者都可</span></span><br><span class="line"><span class="built_in">string</span> s5 = <span class="string">"hiya"</span> <span class="comment">// 拷贝～</span></span><br><span class="line"><span class="built_in">string</span> s6(<span class="string">"hiya"</span>)  <span class="comment">// 直接～</span></span><br><span class="line"><span class="built_in">string</span> s7(<span class="number">10</span>,<span class="string">'c'</span>)  <span class="comment">// 直接～</span></span><br><span class="line"><span class="built_in">string</span> s8 = <span class="built_in">string</span>(<span class="number">10</span>, <span class="string">'c'</span>)</span><br><span class="line"><span class="comment">// 多个值初始化强行用拷贝～，需要显式地创建一个（临时）对象用于拷贝。</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-2-2-string对象上的操作"><a href="#3-2-2-string对象上的操作" class="headerlink" title="3.2.2 string对象上的操作"></a>3.2.2 string对象上的操作</h3><ul>
<li><strong>os&lt;&lt;s</strong> 将s写到输出流os当中，返回os</li>
<li><strong>is&gt;&gt;s</strong> 从is中读取字符串赋给s，字符串以空白分隔，返回is</li>
<li><strong>getline(is, s)</strong> 从is中读取一行赋给s，返回is</li>
</ul>
<p><strong>读写string对象</strong></p>
<ul>
<li>string对象会自动忽略开头的空白（即空格符、换行符、制表符等）并从第一个真正的字符读起，直到遇见下一个空白为止。</li>
</ul>
<p><strong>使用getline读取一整行</strong></p>
<ul>
<li>getline函数的参数是一个输入流和一个string对象，函数从给定的输入流中读取内容，直到遇到换行符为止（注意换行符也被读进来了），然后把所读的内容存入到那个string对象中去（注意不存换行符）</li>
<li>同输入运算符一样，getline也会返回它的流参数<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> <span class="built_in">line</span>; <span class="comment">//每次读入一整行，直到文件末尾</span></span><br><span class="line"><span class="keyword">while</span>(getline(<span class="built_in">cin</span>,<span class="built_in">line</span>))</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">line</span>&lt;&lt;<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>string::size_type 类型</strong></p>
<ul>
<li>size函数返回string对象的长度</li>
<li>size函数返回的是一个string::size_type 类型的值</li>
<li>string::size_type是一个无符号类型的值，而且能足够存放下任何string对象的大小。</li>
<li>可以利用C++11新标准，用auto或者decltype来推断变量的类型</li>
<li>假设n是一个具有负值的int，则表达式<strong>s.size()&lt;n</strong> 的结果一定是true，因为负值n会自动地转换成一个比较大的无符号值。所以如果一条表达式中已有了size函数就不要再使用int了，这样可以避免混用int和unsigned可能带来的问题。</li>
</ul>
<p><strong>字面值和string对象相加</strong></p>
<ul>
<li>当把string对象和字符字面值及字符串字面值混在一条语句中使用时，必须确保每个加法运算符+的两侧的运算对象至少一个是string<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> s4 = s1 + <span class="string">", "</span>; <span class="comment">// 正确</span></span><br><span class="line"><span class="built_in">string</span> s5 = <span class="string">"hello"</span> + <span class="string">", "</span>; <span class="comment">// 错误</span></span><br></pre></td></tr></table></figure></li>
<li>由于历史原因，也为了与C兼容，所以C++语言中的字符串字面值并不是标准库类型string的对象。切记，字符串字面值与string是不同的类型。</li>
</ul>
<h3 id="3-2-3-处理string对象中的字符"><a href="#3-2-3-处理string对象中的字符" class="headerlink" title="3.2.3 处理string对象中的字符"></a>3.2.3 处理string对象中的字符</h3><p><strong>cctype头文件中的函数</strong></p>
<ul>
<li>isalnum(c) 是数字或数字？</li>
<li>isalpha(c) 是字母？</li>
<li>isdigit(c) 是数字？</li>
<li>islower(c) 是小写字母？</li>
<li>isupper(c) 是大写字母？</li>
<li>isspace(c) 是空白？</li>
<li>ispunct(c) 是标点？</li>
<li>isxdigit(c)是十六进制数？</li>
<li>tolower(c) 是大写字母则转为小写，不是则原样输出c</li>
<li>toupper(c) 和上同理</li>
</ul>
<p><strong>使用范围for语句处理每个字符</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统计标点符号个数</span></span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(<span class="string">"hello world!!!"</span>)</span></span>;</span><br><span class="line">    <span class="keyword">decltype</span>(s.<span class="built_in">size</span>()) punct_cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:s)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">ispunct</span>(c))</span><br><span class="line">            ++punct_cnt;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; punct_cnt</span><br><span class="line">         &lt;&lt; <span class="string">" punctuation characters in"</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变字符串中的字符</span></span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(<span class="string">"Hello World!"</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;c:s)</span><br><span class="line">        c = <span class="built_in">toupper</span>(c);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; s &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<p><strong>处理一部分字符</strong></p>
<ul>
<li>访问string对象中的单个字符有两种方式：<ul>
<li>使用下标</li>
<li>使用迭代器</li>
</ul>
</li>
<li><strong>下标运算符( [ ] )</strong> 接收的输入参数是string::size_type类型的值，这个参数表示要访问的字符的为止，返回值是该位置上的字符的引用。</li>
<li>下标的值称作“下标”或“索引”，任何表达式只要它的值是一个整型值就能作为索引。不过，如果某个索引是带符号类型的值将自动转换成由string::size_type表达的无符号类型。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用下标执行迭代</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">decltype</span>(s.<span class="built_in">size</span>()) index = <span class="number">0</span>;</span><br><span class="line">    index != s.<span class="built_in">size</span>() &amp;&amp; !<span class="built_in">isspace</span>(s[index]);</span><br><span class="line">    ++index)</span><br><span class="line">    s[index] = <span class="built_in">toupper</span>(s[index]);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="3-3-标准库类型-vector（容器）"><a href="#3-3-标准库类型-vector（容器）" class="headerlink" title="3.3 标准库类型 vector（容器）"></a>3.3 标准库类型 vector（容器）</h2><ul>
<li>C++语言既有类模板(class template)，也有函数模板，其中vector是一个类模板</li>
<li>编译器根据模板创建类或函数的过程称为<strong>实例化</strong></li>
</ul>
<h3 id="3-3-1-定义和初始化vector对象"><a href="#3-3-1-定义和初始化vector对象" class="headerlink" title="3.3.1 定义和初始化vector对象"></a>3.3.1 定义和初始化vector对象</h3><ul>
<li>vector<T> v1 v1是空vector，执行默认初始化</li>
<li>vector<T> v2(v1) v2中包含有v2中所有元素的副本</li>
<li>vector<T> v2 = v1 同上等价</li>
<li>vector<T> v3(n, val) v3中包含了n个重复的元素val</li>
<li>vector<T> v4(n) v4包含n个元素，默认初始化</li>
<li>vector<T> v5{a,b,c…}</li>
<li>vector<T> v5 = {a,b,c..} 同上等价</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C++11新标准 列表初始化vector对象</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; articles = &#123;<span class="string">"a"</span>,<span class="string">"an"</span>,<span class="string">"the"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建指定数量的元素</span></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">ivec</span><span class="params">(<span class="number">10</span>,<span class="number">-1</span>)</span></span>; <span class="comment">//10个-1</span></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">svec</span><span class="params">(<span class="number">10</span>,<span class="string">"hi"</span>)</span></span>; <span class="comment">//10个string类型的元素，每个都被初始化为"hi"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//值初始化</span></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">ivec</span><span class="params">(<span class="number">10</span>)</span></span>;  <span class="comment">//10个元素，每个都被初始化为0</span></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">svec</span><span class="params">(<span class="number">10</span>)</span></span>;<span class="comment">//10个元素，每个都是空是string对象</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-向vector对象中添加元素"><a href="#3-3-2-向vector对象中添加元素" class="headerlink" title="3.3.2 向vector对象中添加元素"></a>3.3.2 向vector对象中添加元素</h3><ul>
<li>push_back</li>
<li>pop_back</li>
</ul>
<p><strong>向vector对象添加元素蕴含的编程假定</strong><br>如果循环体内包含有向vector对象添加元素的语句，则不能使用范围for循环。范围for语句体内不应改变其遍历序列的大小。</p>
<h2 id="3-4-迭代器"><a href="#3-4-迭代器" class="headerlink" title="3.4 迭代器"></a>3.4 迭代器</h2><ul>
<li>所有标准库容器都可以使用迭代器，但是其中只有少数几种才同时支持下标运算符。</li>
</ul>
<h3 id="3-4-1-使用迭代器"><a href="#3-4-1-使用迭代器" class="headerlink" title="3.4.1 使用迭代器"></a>3.4.1 使用迭代器</h3><ul>
<li>有迭代器的类型同时拥有返回迭代器的成员，这些类型都有名为 begin 和 end 的成员。<ul>
<li><strong>begin</strong>，返回指向第一个元素的迭代器</li>
<li><strong>end</strong>，返回指向容器尾元素的下一个位置的迭代器。称为尾后迭代器(off-the-end iterator)</li>
<li>如果容器为空，则begin和end返回的是同一个迭代器。都是尾后迭代器。</li>
</ul>
</li>
</ul>
<p><strong>泛型编程</strong></p>
<ul>
<li>C++程序员习惯地使用!=，其原因和他们更愿意使用迭代器而非下标的原因一样：因为这种编程风格在标准库提供的所有容器上都有效。</li>
</ul>
<p><strong>迭代器类型</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it; <span class="comment">// it能读写vector&lt;int&gt;的元素</span></span><br><span class="line"><span class="built_in">string</span>::iterator it2;  <span class="comment">// it2能读写string 对象中的字符</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::const_iterator it3; <span class="comment">// it3只能读元素，不能写元素</span></span><br><span class="line"><span class="built_in">string</span>::const_iterator it4; <span class="comment">// it4只能读字符，不能写字符</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>const_iterator和常量指针差不多，能读取但不能修改它所指的元素值。</p>
<ul>
<li>如果vector对象或string对象是一个常量，只能用const_iterator</li>
<li>如果vector对象或string对象不是常量，即可用iterator也能使用const_iterator</li>
</ul>
</li>
<li><p>begin和end运算符</p>
<ul>
<li>begin和end返回的具体类型由对象是否是常量决定。是iterator还是const_iterator</li>
<li><strong>C++11新标准</strong>，为了便于专门得到const_iterator类型的返回值，引入两个新函数<ul>
<li>cbegin()</li>
<li>cend()</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>结合解引用和成员访问操作</strong></p>
<ul>
<li>it-&gt;men 和 (*it).men 等价</li>
<li>箭头运算符把解引用和成员访问两个操作结合在了一起</li>
</ul>
<p><strong>某些对vector对象的操作会使迭代器失效</strong></p>
<ul>
<li>不能在范围for循环中向vector对象添加元素</li>
<li>任何一种可能改变vector对象容量的操作，比如push_back，都会使该vector对象的迭代器失效。</li>
<li>谨记，凡是使用了迭代器的循环体，都不要向迭代器所属的容器添加元素</li>
</ul>
<h3 id="3-4-2-迭代器运算"><a href="#3-4-2-迭代器运算" class="headerlink" title="3.4.2 迭代器运算"></a>3.4.2 迭代器运算</h3><ul>
<li>只要两迭代器指向的是同一个容器中的元素或者尾元素的下一个位置，就能将其相减，结果是两个迭代器的举例。类型是名为 <strong>difference_type</strong> 的带符号整数类型，因为这个距离可正可负。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二分搜索，text有序，beg和end是搜索范围</span></span><br><span class="line"><span class="keyword">auto</span> beg = <span class="built_in">text</span>.<span class="built_in">begin</span>(), <span class="built_in">end</span> = <span class="built_in">text</span>.<span class="built_in">end</span>();</span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">min</span> = <span class="built_in">text</span>.<span class="built_in">begin</span>() + (<span class="built_in">end</span> - beg)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">while</span>(mid != <span class="built_in">end</span> &amp;&amp; *mid != sought)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (sought &lt; *mid)</span><br><span class="line">        <span class="built_in">end</span> = mid;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        beg = mid + <span class="number">1</span>;</span><br><span class="line">    mid = beg + (<span class="built_in">end</span> - beg)/<span class="number">2</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-数组"><a href="#3-5-数组" class="headerlink" title="3.5 数组"></a>3.5 数组</h2><ul>
<li>数组是一种复合类型，声明 a[n], n是数组维度。维度必须是一个常量表达式<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> cnt = <span class="number">42</span>;   <span class="comment">//不是常量表达式</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">unsigned</span> sz = <span class="number">42</span>; <span class="comment">//常量表达式</span></span><br><span class="line"><span class="keyword">int</span> arr[<span class="number">10</span>];  <span class="comment">//含有10个整数的数组</span></span><br><span class="line"><span class="keyword">int</span> *parr[sz]; <span class="comment">//含有42个整型指针的数组</span></span><br><span class="line"><span class="built_in">string</span> bad[cnt];  <span class="comment">//错误：cnt不是常量表达式</span></span><br><span class="line">stromg strs[get_size()]; <span class="comment">// 只有get_size是constexpr时正确</span></span><br></pre></td></tr></table></figure></li>
<li>和内置类型的变量一样，如果在函数内部定义了某种类型的数组，那么默认初始化会令数组含有为定义的值。</li>
</ul>
<p><strong>字符数组的特殊性</strong></p>
<ul>
<li>字符数组有一种额外的初始化形式，可以用字符串字面值对此类数组初始化。当使用这种方式时，一定要注意字符串字面值的结尾处还有一个空字符，这个空字符也会像字符串的其他字符一样被拷贝到字符数组中去。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> a1[] = &#123;<span class="string">'C'</span>,<span class="string">'+'</span>,<span class="string">'+'</span>&#125;; <span class="comment">//列表初始化，没有空字符，维度3</span></span><br><span class="line"><span class="keyword">char</span> a2[] = &#123;<span class="string">'C'</span>,<span class="string">'+'</span>,<span class="string">'+'</span>,<span class="string">'\0'</span>&#125;; <span class="comment">//列表初始化，含有显式的空字符，维度4</span></span><br><span class="line"><span class="keyword">char</span> a3[] = <span class="string">"C++"</span>; <span class="comment">//自动添加表示字符串结束的空字符，维度4</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> a4[<span class="number">6</span>] = <span class="string">"Daniel"</span>; <span class="comment">// 错误：没有空间放空字符！</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>不允许拷贝和赋值</strong></p>
<ul>
<li>不能将数组的内容拷贝给其他数组作为其初始值，也不能用数组为其他数组赋值。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;; <span class="comment">//含有三个整数的数组</span></span><br><span class="line"><span class="keyword">int</span> a2[] = a; <span class="comment">//错误：不允许使用一个数组初始化另一个数组</span></span><br><span class="line">a2 = a;       <span class="comment">//错误：不能把一个数组直接赋值给另一个数组</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>理解复杂的数组声明</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从数组的名字开始按照由内向外的顺序阅读</span></span><br><span class="line"><span class="keyword">int</span> *ptrs[<span class="number">10</span>];   <span class="comment">//ptrs是含有10个整型指针的数组。</span></span><br><span class="line"><span class="keyword">int</span> &amp;refs[<span class="number">10</span>] = <span class="comment">/* ? */</span> <span class="comment">//错误：不存在引用的数组</span></span><br><span class="line"><span class="keyword">int</span> (*Parray)[<span class="number">10</span>] = &amp;arr; <span class="comment">//Parray指向一个含有10个整数的数组</span></span><br><span class="line"><span class="keyword">int</span> (&amp;Parray)[<span class="number">10</span>] = arr; <span class="comment">//arrRef引用一个含有10个整数的数组</span></span><br><span class="line"><span class="keyword">int</span> *(&amp;arry)[<span class="number">10</span>] = ptrs; <span class="comment">//arry是数组的引用，该数组含有10个指针</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-2-访问数组元素"><a href="#3-5-2-访问数组元素" class="headerlink" title="3.5.2 访问数组元素"></a>3.5.2 访问数组元素</h3><ul>
<li>在使用数组下标的时候，通常定义为<strong>size_t</strong>类型。这是一种机器相关的无符号类型，它被设计得足够大以便能表示内存中任意对象的大小。在<strong>cstddef头文件</strong>中定义了<strong>size_t</strong>类型。</li>
</ul>
<h3 id="3-5-3-指针和数组"><a href="#3-5-3-指针和数组" class="headerlink" title="3.5.3 指针和数组"></a>3.5.3 指针和数组</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> nums[] = &#123;<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>&#125;;</span><br><span class="line"><span class="built_in">string</span> *p = &amp;nums[<span class="number">0</span>]; <span class="comment">// p指向nums的第一个元素</span></span><br><span class="line"><span class="built_in">string</span> *p2 = nums; <span class="comment">// 与 p2 = &amp;nums[0]等价</span></span><br></pre></td></tr></table></figure>
<ul>
<li>数组有一个特性：在很多用到数组名字的地方，编译器都会自动地将其替换为一个指向数组首元素的指针<ul>
<li>根据这个特性，当使用数组作为一个auto变量的初始值时，推断得到的类型是指针而非数组</li>
<li>当使用decltype关键字时上述类型转换不会发生，decltype(ia)返回的类型是由5个整数构成的数组<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">ia2</span><span class="params">(ia)</span></span>;  <span class="comment">// ia2是一个整型指针，指向ia的第一个元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">decltype</span>(ia) ia3 = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">ia3 = p;    <span class="comment">// 错误：不能用整型指针给数组赋值</span></span><br><span class="line">ia3[<span class="number">4</span>] = i; <span class="comment">// 正确：把i的值赋给ia3的一个元素</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p><strong>指针也是迭代器</strong></p>
<ul>
<li>通过数组名字或者数组中首元素的地址都能得到还想首元素的指针</li>
<li>获取尾后指针，可以设法获取数组尾元素之后的那个并不存在的元素的地址<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *e = &amp;arr[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> *b = arr; b != e; ++b)</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *b &lt;&lt; <span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>标准库函数 begin 和 end</strong></p>
<ul>
<li><strong>C++11新标准</strong>引入了begin和end，这两个函数与容器中的两个同名成员功能类似，不过数组毕竟不是类类型，因此这两个函数不是成员函数。正确的使用形式是将数组作为他们的参数<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> *beg = <span class="built_in">begin</span>(ia); <span class="comment">// 指向ia的首元素的指针</span></span><br><span class="line"><span class="keyword">int</span> *<span class="built_in">end</span> = <span class="built_in">end</span>(ia);   <span class="comment">// 指向arr尾元素的下一个位置的指针</span></span><br></pre></td></tr></table></figure></li>
<li>尾后指针不能执行解引用和递增操作</li>
</ul>
<p><strong>指针运算</strong></p>
<ul>
<li>两个指针相减的类型是 <strong>ptrdiff_t</strong> 的标准库类型，和size_t一样，也是一种定义在cstddef头文件中的机器相关的类型。因为差值可能是负的，所以是一种带符号类型。</li>
</ul>
<p><strong>下标和指针</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[] = &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> *p = &amp;ia[<span class="number">2</span>]; <span class="comment">// p指向索引为2的元素</span></span><br><span class="line"><span class="keyword">int</span> j = p[<span class="number">1</span>];    <span class="comment">// p[1]等价于*(p+1),即ia[3]</span></span><br><span class="line"><span class="keyword">int</span> k = p[<span class="number">-2</span>];   <span class="comment">// p[-2]是ia[0]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>虽然标准库类型string和vector也能执行下标运算，但是标准库类型限定使用的下标必须是无符号类型，而内置的下标运算无此要求，上例即说明了这点。内置的下标运算符可以处理负值，结果地址必须指向原来的指针所指同一数组中的元素</li>
</ul>
<h3 id="3-5-4-C风格字符串"><a href="#3-5-4-C风格字符串" class="headerlink" title="3.5.4 C风格字符串"></a>3.5.4 C风格字符串</h3><p><strong>C标准String函数</strong></p>
<ul>
<li>strlen(p)</li>
<li>strcmp(p1,p2)</li>
<li>strcat(p1,p2) 将p2附加到p1后，返回p1</li>
<li>strcpy(p1,p2) 将p2拷贝给p1，返回p1</li>
</ul>
<p><strong>目标字符串的大小由调用者指定</strong></p>
<ul>
<li>连接或拷贝C风格字符串于标准库string对象的同类操作差别很大，比如两个字符串相加<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标准库string</span></span><br><span class="line"><span class="built_in">string</span> largeStr = s1 + <span class="string">" "</span> + s2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C风格，使用strcat和strcpy必须提供一个用于存放结果字符串的数组，该数组必须足够大以便容纳结果字符串及末尾的空字符。</span></span><br><span class="line"><span class="built_in">strcpy</span>(largeStr, ca1);</span><br><span class="line"><span class="built_in">strcat</span>(largeStr, <span class="string">" "</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(largeStr, ca2);</span><br><span class="line"><span class="comment">// 如果计算错了largeStr的大小将引发严重错误</span></span><br></pre></td></tr></table></figure></li>
<li>使用标准库string要比C风格字符串更安全，更高效</li>
</ul>
<h3 id="3-5-5-与旧代码的接口"><a href="#3-5-5-与旧代码的接口" class="headerlink" title="3.5.5 与旧代码的接口"></a>3.5.5 与旧代码的接口</h3><p><strong>混用string对象和C风格字符串</strong></p>
<ul>
<li>任何出现字符串字面值的地方都可以用以空字符结束的字符数组来替代：<ul>
<li>允许使用以空字符结束的字符数组来初始化tring对象或为string对象赋值</li>
<li>在string对象的加法运算中使用以空字符结束的字符数组作为其中一个运算对象（不能两个都是）：在string对象的复合赋值运算中允许使用以空字符结束的字符数组作为右侧的运算对象</li>
</ul>
</li>
<li>string专门提供来一个名为c_str的成员函数<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(<span class="string">"hello world"</span>)</span></span>;</span><br><span class="line"><span class="keyword">char</span> *str = s;  <span class="comment">//错误：不能用string对象初始化char</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *str = s.c_str(); <span class="comment">//正确</span></span><br></pre></td></tr></table></figure></li>
<li>c_str函数的返回值是一个C风格的字符串。即以一个指针，该指针指向一个以空字符结束的字符数组。</li>
</ul>
<p><strong>使用数组初始化vector对象</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> int_arr[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">ivec</span><span class="params">(<span class="built_in">begin</span>(int_arr),<span class="built_in">end</span>(int_arr))</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>现代的C++程序应当尽量使用vector和迭代器，避免使用内置数组和指针</li>
<li>应尽量使用string，避免使用C风格的基于数组的字符串</li>
</ul>
<h2 id="3-6-多维数组"><a href="#3-6-多维数组" class="headerlink" title="3.6 多维数组"></a>3.6 多维数组</h2><ul>
<li>类似于一维数组，在初始化多维数组时也并非所有的元素的值都必须包含在初始化列表中<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ia[<span class="number">3</span>][<span class="number">4</span>] = &#123; &#123;<span class="number">0</span>&#125;, &#123;<span class="number">4</span>&#125; ,&#123;<span class="number">8</span>&#125; &#125;;</span><br><span class="line"><span class="comment">//只初始化每行的首元素，其他未列出的元素执行默认值初始化</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>多维数组的下标引用</strong></p>
<ul>
<li>经常用两层嵌套for循环来处理多维数组的元素<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> rowCnt = <span class="number">3</span>, colCnt = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">int</span> ia[rowCnt][colCnt];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">size_t</span> i = <span class="number">0</span>; i != rowCnt; ++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> j = <span class="number">0</span>; j != colCnt; ++j)</span><br><span class="line">        ia[i][j] = i * colCnt + j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>使用范围for语句处理多维数组</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;row : ia)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;col : row)</span><br><span class="line">    &#123;</span><br><span class="line">        col = cnt;</span><br><span class="line">        ++cnt;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>为什么要用引用？<strong>为了避免数组被自动转成指针</strong><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;row : ia)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> col : row)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;col&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line"><span class="comment">// 上面编译通过，下面报错</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> row : ia)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> col : row)</span><br></pre></td></tr></table></figure></li>
<li>由于row不是引用类型，所以编译器初始化row时会自动将这些数组形式的元素转换成指向该数组内首元素的指针。这样得到的row的类型就是 int* ，显然内层的循环就不合法了。</li>
<li>使用范围for语句处理多维数组，除了最内层的循环外，其他所有循环的控制变量都应该是引用类型。</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag">C++基础知识</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">C++学习笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E3%80%8AC-Primer-Plus%E3%80%8B/" rel="tag">《C++ Primer Plus》</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/16/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/18/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2021
        zhuozhu
      </li>
      <li>
        
        Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Shine on You Crazy Diamond"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/02/25/About_me">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Suche">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['Remember when you were young, you shine like the sun.  -', 'Shine on you crazy diamond.', ''],
      startDelay: 0,
      typeSpeed: 80,
      loop: true,
      backSpeed: 40,
      showCursor: true
    });
  } catch (err) {
  }

</script>





<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>



<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>



    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
        
    




<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>

  
<script src="/js/clickLove.js"></script>



    
  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":200,"height":450},"mobile":{"show":true},"rect":{"opacity":0.7},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>